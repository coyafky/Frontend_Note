webpackJsonp([6],{1040:function(t,e,i){function n(t){i(1070)}var s=i(8)(i(1071),i(1083),n,"data-v-746db1b2",null);t.exports=s.exports},1050:function(t,e,i){function n(t){i(1051)}var s=i(8)(i(1052),i(1053),n,"data-v-defc1ee6",null);t.exports=s.exports},1051:function(t,e){},1052:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(34);e.default={data:function(){return{show:!1}},computed:{isWechat:function(){return Object(n.c)()}},filters:{},methods:{loginWithWechat:function(){return this.$getBean("oauthBusiness").loginWithWechat()},close:function(){this.show=!1},authoLogin:function(){this.show=!1,this.$requestLogin()}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.AUTH_WECHAT_QUICK_LOGIN,function(){t.isWechat?t.show=!0:t.$requestLogin()})}}},1053:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.show?i("div",{staticClass:"wechat-quick-login"},[i("div",{staticClass:"quick-box"},[t._m(0),i("div",{staticClass:"auth-box"},[i("div",{staticClass:"auth-btn wx",on:{click:t.loginWithWechat}},[t._m(1),i("span",[t._v("微信快捷登录")])]),i("div",{staticClass:"auth-btn jj",on:{click:t.authoLogin}},[t._m(2),i("span",[t._v("掘金账号登录")])])]),i("div",{staticClass:"footer"},[i("div",{staticClass:"box",on:{click:t.close}},[t._v("取消")])])])]):t._e()},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"header"},[i("div",{staticClass:"title"},[t._v("未登录")]),i("div",{staticClass:"desc"},[t._v("注册或登录后即可继续操作")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[n("img",{attrs:{src:i(1054)}})])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[n("img",{attrs:{src:i(1055)}})])}]}},1054:function(t,e,i){t.exports=i.p+"static/img/wechat.5e2cfe7.svg"},1055:function(t,e){t.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQwcHgiIGhlaWdodD0iNDBweCIgdmlld0JveD0iMCAwIDQwIDQwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbG5zOnNrZXRjaD0iaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoL25zIj4KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggMy4zLjMgKDEyMDgxKSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5qdWVqaW5fbG9nbyBjb3B5PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+PC9kZWZzPgogICAgPGcgaWQ9IlBhZ2UtMSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgc2tldGNoOnR5cGU9Ik1TUGFnZSI+CiAgICAgICAgPGcgaWQ9Imp1ZWppbl9sb2dvLWNvcHkiIHNrZXRjaDp0eXBlPSJNU0FydGJvYXJkR3JvdXAiIGZpbGw9IiNGRkZGRkYiPgogICAgICAgICAgICA8cGF0aCBkPSJNMjMuMjgxOTk4NCw3LjcwMzA1NDUgTDE5Ljg1Mzg3MTQsNSBMMTYuMjcyMTkxOCw3LjgyNDE3NTcgTDE2LjA4NjUzODgsNy45NzM3NTcwNyBMMTkuODUzODcxNCwxMC45Nzc2MjkgTDIzLjYzMjc4NjYsNy45NzM3NTcwNyBMMjMuMjgxOTk4NCw3LjcwMzA1NDUgWiBNMzYuMjcyNzQzMywxOC4xODU2NjQgTDE5Ljg0Mzk0MzQsMzEuMTQwMDA2NCBMMy40MjUwNzE0MywxOC4xOTM2MDY0IEwxLDIwLjE0MTQ3MzUgTDE5Ljg0Mzk0MzQsMzUgTDM4LjY5ODE0NTcsMjAuMTMzNTMxMiBMMzYuMjcyNzQzMywxOC4xODU2NjQgWiBNMTkuODQzOTQzNCwxOS4yMzY3MDQ4IEwxMC45MDM4MDksMTIuMTg3NTE3MiBMOC40Nzg0MDY2NywxNC4xMzUzODQ0IEwxOS44NDM5NDM0LDIzLjA5NzAyOTMgTDMxLjIxOTA3NzEsMTQuMTI3NDQyIEwyOC43OTM2NzQ4LDEyLjE3OTU3NDkgTDE5Ljg0Mzk0MzQsMTkuMjM2NzA0OCBaIiBpZD0iRmlsbC0xLUNvcHktMiIgc2tldGNoOnR5cGU9Ik1TU2hhcGVHcm91cCI+PC9wYXRoPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+"},1056:function(t,e,i){function n(t){i(1057)}var s=i(8)(i(1058),i(1063),n,"data-v-efcd2e56",null);t.exports=s.exports},1057:function(t,e){},1058:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(5),s=i.n(n),o=i(10),a=i(985),r=i.n(a),c=i(222),u=i.n(c),l=i(1059),d=i.n(l);e.default={components:{Avatar:u.a,ImageUploader:d.a},props:["user","entry","vote","placeholder","type"],data:function(){return{content:"",isActionBoxVisible:!1,submitting:!1,metaKey:!1,ctrlKey:!1,enterKey:!1}},computed:{submitAction:function(){switch(this.type){case"book":return o.SUBMIT_BOOK_COMMENT;case"repo":return o.SUBMIT_REPO_COMMENT;default:return o.SUBMIT_COMMENT}},displayedPlaceholder:function(){return this.placeholder||"说说你的看法"}},watch:{content:function(t){t&&!this.user&&this.$requestRegister()}},methods:{focus:function(){this.user&&this.$refs.input.focus()},blur:function(){this.content||(this.isActionBoxVisible=!1)},submit:function(){var t=this,e=this.entry,i=this.content.trim();return this.user?i?(this.submitting=!0,void this.uploadImage().then(function(n){return t.$store.dispatch(t.submitAction,{entry:e,content:i,imageUrl:n})}).then(function(){t.$barrage(t.content),t.$refs.imageUploader.cleanFile(),t.content="",t.submitting=!1,t.$nextTick(function(){r.a.update(t.$refs.input)}),t.$emit("submitted")}).catch(function(e){t.submitting=!1,t.$error(e)})):void this.$alert("评论不能为空"):void this.$requestRegister()},uploadImage:function(){return this.$refs.imageUploader.file?this.$refs.imageUploader.upload():s.a.resolve()},listenerKeykown:function(t){var e={17:"ctrlKey",91:"metaKey",93:"metaKey",224:"metaKey",13:"enterKey"},i=e[t.keyCode];i&&(this[i]=!0)},listenerKeyup:function(t){this.ctrlKey=!1,this.metaKey=!1,this.enterKey=!1},quickSubmit:function(t){(this.metaKey||this.ctrlKey)&&this.enterKey&&this.submit()}},mounted:function(){r()(this.$refs.input)}}},1059:function(t,e,i){function n(t){i(1060)}var s=i(8)(i(1061),i(1062),n,"data-v-54e3f196",null);t.exports=s.exports},1060:function(t,e){},1061:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(114),s=["jpg","png"];e.default={data:function(){return{file:null,url:null}},methods:{showFileDialog:function(){this.$refs.input.click()},changeFile:function(t){this.file=t,window.URL.revokeObjectURL(this.url),this.url=t?window.URL.createObjectURL(t):null},cleanFile:function(){this.changeFile(null)},onActionBoxClick:function(){this.url?this.cleanFile():this.showFileDialog()},onFileSelected:function(t){var e=this;if(this.$refs.input.value=null,t)return this.isWithVaildSize(t)?void Object(n.a)(t,s).then(function(i){i?e.changeFile(t):e.$alert("不支持此格式的图片上传")}):void this.$alert("文件过大")},isWithVaildSize:function(t){return t.size<=1048576},upload:function(){return this.$getBean("uploadBusiness").uploadFile(this.file)}}}},1062:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"image-uploader"},[i("input",{ref:"input",staticClass:"input",attrs:{type:"file"},on:{change:function(e){t.onFileSelected(e.target.files[0])}}}),t.url?i("div",{staticClass:"preview-box"},[i("img",{staticClass:"preview",attrs:{src:t.url}}),i("button",{staticClass:"clean-btn",attrs:{title:"移除图片"},on:{click:t.cleanFile}},[i("i",{staticClass:"ion-close-circled"})])]):i("button",{staticClass:"upload-btn",on:{click:t.showFileDialog}},[i("i",{staticClass:"icon ion-image"}),i("span",[t._v("上传图片")])])])},staticRenderFns:[]}},1063:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"comment-form",class:{unauthorized:!t.user},on:{click:function(t){t.stopPropagation()},keyup:function(e){e.stopPropagation(),t.listenerKeyup(e)},keydown:t.listenerKeykown}},[t.user?[i("avatar",{staticClass:"avatar",attrs:{user:t.user,decorative:!0}}),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],ref:"input",staticClass:"content-input",attrs:{placeholder:t.displayedPlaceholder},domProps:{value:t.content},on:{focus:function(e){t.isActionBoxVisible=!0},keyup:t.quickSubmit,input:function(e){e.target.composing||(t.content=e.target.value)}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isActionBoxVisible||t.vote,expression:"isActionBoxVisible || vote"}],staticClass:"action-box"},[i("image-uploader",{directives:[{name:"show",rawName:"v-show",value:t.vote,expression:"vote"}],ref:"imageUploader",staticClass:"image-uploader"}),i("div",{staticClass:"submit-box"},[i("span",{staticClass:"submit-text"},[t._v("Ctrl or ⌘ + Enter")]),i("button",{staticClass:"submit-btn",on:{click:t.submit}},[t._v("评论")])])],1),t.submitting?i("div",{staticClass:"submitting-mask"},[t._v("提交中...")]):t._e()]:[i("div",{staticClass:"unauthorized-panel"},[i("button",{staticClass:"authorize-btn",on:{click:function(e){t.$requestLogin()}}},[t._v("登录")]),i("div",{staticClass:"placeholder"},[t._v(t._s(t.displayedPlaceholder))])])]],2)},staticRenderFns:[]}},1064:function(t,e,i){function n(t){i(1065)}var s=i(8)(i(1066),i(1086),n,"data-v-51163f89",null);t.exports=s.exports},1065:function(t,e){},1066:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(94),s=i.n(n),o=i(10),a=i(58),r=i(31),c=i(1067),u=i.n(c);e.default={components:{Comment:u.a},props:["list","entry","type","loading","manual"],computed:s()({},Object(a.mapGetters)({user:o.USER}),{removable:function(){return(!this.type||"entry"===this.type)&&this.user&&this.entry&&this.entry.user&&this.user.id===this.entry.user.id}}),methods:{fetchMoreIfConditionIsSatisfied:function(){if(!this.manual){Object(r.b)(this.$refs.list)>-200&&this.fetchMore()}},fetchMore:function(){return this.$emit("should-fetch-more")},remove:function(t){var e=this;this.$store.dispatch(o.DELETE_COMMENT,{entry:this.entry,comment:t}).then(function(){e.$alert("评论删除成功")}).catch(function(t){e.$error(t)})}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.ROOT_CONTAINER_SCROLL,function(){t.fetchMoreIfConditionIsSatisfied()}),Object(r.f)(this.$refs.list,function(){t.fetchMoreIfConditionIsSatisfied()})}}},1067:function(t,e,i){function n(t){i(1068)}var s=i(8)(i(1069),i(1085),n,"data-v-7f6a837b",null);t.exports=s.exports},1068:function(t,e){},1069:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=(i(58),i(20)),o=i(115),a=i(223),r=i(34),c=i(222),u=i.n(c),l=i(965),d=i.n(l),m=i(1040),f=i.n(m),h=i(986),p=i.n(h);e.default={components:{Avatar:u.a,UserPopover:d.a,SubCommentBox:f.a,ConfirmDialog:p.a},props:["comment","entry","type","removable"],data:function(){return{isShowAll:!1,isSubCommentBoxActive:!1,autoUnfold:!1,isRemoveDialogVisible:!1,likeLock:Object(a.a)()}},computed:{isMobile:function(){return Object(r.d)()},date:function(){return Object(s.d)(this.comment.createdAt)},displayedLikeCount:function(){return Object(o.a)(this.comment.likesCount)},replyPlaceholder:function(){return"对 "+this.comment.user.username+" 的回复"},toggleSubCommentBtnTitle:function(){var t=this.comment.subCount;return this.isSubCommentBoxActive?"收起评论":t?this.comment.subCount+"条评论":"评论"},limitedContent:function(){return this.$getBean("commentBusiness").limitCommentContent(this.comment.content)},collapsed:function(){return this.limitedContent.length<this.comment.content.length&&!this.isShowAll},toggleLikeAction:function(){switch(this.type){case"book":return n.TOGGLE_LIKE_BOOK_COMMENT;case"repo":return n.TOGGLE_LIKE_REPO_COMMENT;default:return n.TOGGLE_LIKE_COMMENT}}},methods:{updateAutoUnfold:function(t){this.autoUnfold=t},toggleLike:function(){var t=this;this.likeLock.do(function(){return t.$ensureAuthorized().then(function(){return t.$store.dispatch(t.toggleLikeAction,{comment:t.comment,entry:t.entry}).catch(function(e){t.$error(e)})}).catch(function(){})})},toggleSubCommentBox:function(){this.isSubCommentBoxActive=!this.isSubCommentBoxActive},remove:function(){this.isRemoveDialogVisible=!1,this.$emit("remove")}},mounted:function(){"book"===this.type&&this.comment.subCount>0&&!this.isMobile&&(this.autoUnfold=!0,this.isSubCommentBoxActive=!0),this.comment.createdAt=this.comment.createdAt}}},1070:function(t,e){},1071:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(3),s=i.n(n),o=i(5),a=i.n(o),r=i(10),c=i(223),u=i(31),l=i(34),d=i(1072),m=i.n(d),f=i(1079),h=i.n(f),p=i(985),v=i.n(p),g=(i(29),function(){return{page:1,total:0,list:[],fetchLock:Object(c.a)(),replyLock:Object(c.a)(),replyForm:{content:"",comment:null},metaKey:!1,ctrlKey:!1,enterKey:!1}});e.default={components:{SubComment:m.a,Pagination:h.a},props:["parent","entry","type","removable","autoUnfold"],data:g,computed:{isMobile:function(){return Object(l.d)()},pageSize:function(){return this.isMobile?20:5},replyPlaceholder:function(){var t=((this.replyForm.comment||{}).user||{}).username,e="book"===this.type?"评论审核通过后显示":"输入评论";return t?"回复 "+t+" ：":e},shouldCancelReply:function(){return this.replyForm.comment&&!this.replyForm.content},canReply:function(){return!!this.replyForm.content.trim()},replyBtnTitle:function(){return this.shouldCancelReply?"取消":"评论"},totalPage:function(){return Math.max(Math.ceil(this.total/5),1)},startTime:function(){return this.list.length?this.list[this.list.length-1].createdAt:null},fetching:function(){return this.fetchLock.busy},empty:function(){return!this.list.length&&!this.fetching},commentBusiness:function(){switch(this.type){case"book":return this.$getBean("xiaoceCommentBusiness");case"repo":return this.$getBean("repoCommentBusiness");default:return this.$getBean("commentBusiness")}},replyAction:function(){switch(this.type){case"book":return r.REPLY_BOOK_COMMENT;case"repo":return r.REPLY_REPO_COMMENT;default:return r.REPLY_COMMENT}}},methods:{close:function(){this.$emit("close")},getTarUser:function(t){return t.replyCommentId!==this.parent.id?t.replyUser:null},prepareReply:function(t){this.$refs.replyInput.focus(),this.replyForm.content="",this.replyForm.comment=t},cancelReply:function(){this.replyForm.content="",this.replyForm.comment=null},listenerKeyup:function(t){this.ctrlKey=!1,this.metaKey=!1,this.enterKey=!1},listenerKeykown:function(t){var e={17:"ctrlKey",91:"metaKey",93:"metaKey",224:"metaKey",13:"enterKey"},i=e[t.keyCode];i&&(this[i]=!0)},reply:function(){var t=this,e={entry:this.entry,parent:this.parent,tar:this.replyForm.comment||this.parent,content:this.replyForm.content.trim()};this.replyLock.do(function(){return t.$ensureAuthorized().then(function(){return t.$store.dispatch(t.replyAction,e).then(function(){t.$barrage(t.replyForm.content),t.reset(),t.fetch(),t.$nextTick(function(){v.a.update(t.$refs.replyInput)})}).catch(function(e){t.$error(e)})}).catch(function(){})})},onReplyBtnClick:function(){this.shouldCancelReply?this.cancelReply():this.canReply&&this.reply()},remove:function(t){var e=this;this.$store.dispatch(r.DELETE_COMMENT,{parent:this.parent,entry:this.entry,comment:t}).then(function(){e.$alert("回复删除成功"),e.fetch()}).catch(function(t){e.$error(t)})},quickSubmit:function(){(this.metaKey||this.ctrlKey)&&this.enterKey&&this.reply()},fetch:function(){var t=this,e={commentId:this.parent.id,entryId:this.entry.id,page:this.page,pageSize:this.pageSize};if(!this.autoUnfold||"book"!==this.type)return this.fetchLock.do(function(){return t.commentBusiness.getSubCommentList(e).then(function(e){t.list=e.list,t.total=e.total})}).catch(function(e){t.$error(e)});this.$emit("update:auto-unfold",!1),this.list=this.commentBusiness.fromDescriptorSubComment(this.parent.topComment),this.total=this.parent.subCount},gotoPage:function(t){var e=this;this.page=t,this.fetch().then(function(){Object(u.k)(e.$refs.subCommentBox,-110)})},fetchMore:function(){var t=this;this.fetchLock.do(function(){return t.commentBusiness.getSubCommentList({commentId:t.parent.id,entryId:t.entry.id,page:t.page+1,pageSize:t.pageSize}).then(function(e){t.page=t.page+1,t.list=t.list.concat(e.list),t.total=e.total}).then(function(){return new a.a(function(t){return window.setTimeout(t,500)})})}).catch(function(e){t.$error(e)})},reset:function(){s()(this,g())}},mounted:function(){var t=this;if(v()(this.$refs.replyInput),Object(u.h)(this.$refs.subCommentBoxInner,function(e){e<50&&t.fetchMore()}),this.autoUnfold||this.$refs.replyInput.focus(),this.isMobile){var e=this.$getBean("eventBus");e.emit(e.eventType.LOCK_ROOT_CONTAINER_SCROLL)}this.fetch()},beforeDestroy:function(){if(this.isMobile){var t=this.$getBean("eventBus");t.emit(t.eventType.UNLOCK_ROOT_CONTAINER_SCROLL)}}}},1072:function(t,e,i){function n(t){i(1073)}var s=i(8)(i(1074),i(1078),n,"data-v-6fdfc18a",null);t.exports=s.exports},1073:function(t,e){},1074:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(20),s=i(222),o=i.n(s),a=i(965),r=i.n(a),c=i(986),u=i.n(c);e.default={components:{Avatar:o.a,UserPopover:r.a,ConfirmDialog:u.a},props:["comment","tarUser","removable"],data:function(){return{isShowAll:!1,isRemoveDialogVisible:!1}},computed:{date:function(){return Object(n.d)(this.comment.createdAt)},limitedContent:function(){return this.$getBean("commentBusiness").limitCommentContent(this.comment.content)},collapsed:function(){return this.limitedContent.length<this.comment.content.length&&!this.isShowAll}},methods:{reply:function(){this.$emit("reply")},remove:function(){this.isRemoveDialogVisible=!1,this.$emit("remove")}}}},1075:function(t,e){},1076:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["title","content","confirmText","cancelText"],methods:{cancel:function(){this.$emit("cancel")},confirm:function(){this.$emit("confirm")}}}},1077:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"confirm-dialog-box"},[i("div",{staticClass:"confirm-dialog"},[i("div",{staticClass:"dialog-header"},[i("div",{staticClass:"dialog-title"},[t._v(t._s(t.title))]),i("button",{staticClass:"close-btn ion-close-round",attrs:{title:"关闭"},on:{click:t.cancel}})]),i("div",{staticClass:"dialog-body"},[i("div",{staticClass:"content"},[t._v(t._s(t.content))])]),i("div",{staticClass:"dialog-footer"},[i("button",{staticClass:"ctrl-btn cancel-btn",on:{click:t.cancel}},[t._v(t._s(t.cancelText||"取消"))]),i("button",{staticClass:"ctrl-btn confirm-btn",on:{click:t.confirm}},[t._v(t._s(t.confirmText||"确定"))])])])])},staticRenderFns:[]}},1078:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"sub-comment"},[i("user-popover",{staticClass:"user-popover--avatar",attrs:{userId:t.comment.user.id}},[i("avatar",{staticClass:"avatar",attrs:{user:t.comment.user,decorative:!0}})],1),i("div",{staticClass:"content-box"},[i("div",{staticClass:"header"},[i("div",{staticClass:"user-info"},[i("user-popover",{staticClass:"user-popover--info",attrs:{userId:t.comment.user.id}},[i("app-link",{staticClass:"username",attrs:{to:t.$userRoute(t.comment.user),blank:!0}},[t._v(t._s(t.comment.user.username))])],1),i("div",{staticClass:"position"},[t._v(t._s(t.$userPosition(t.comment.user)))])],1)]),i("div",{staticClass:"content"},[t.tarUser?i("span",{staticClass:"text-reply"},[t._v("回复"),i("app-link",{attrs:{to:t.$userRoute(t.tarUser),blank:!0}},[i("span",{staticClass:"username"},[t._v(t._s(t.tarUser.username))])]),t._v("：")],1):t._e(),t.collapsed?i("span",{staticClass:"content-html collapsed"},[t._v(t._s(t.limitedContent))]):i("span",{directives:[{name:"parse-url",rawName:"v-parse-url",value:t.comment.content,expression:"comment.content"}],staticClass:"content-html"}),t.collapsed?i("span",{staticClass:"show-all",on:{click:function(e){t.isShowAll=!0}}},[t._v("展开全部")]):t._e()]),i("div",{staticClass:"footer"},[i("span",{staticClass:"date"},[t._v(t._s(t.date))]),i("a",{staticClass:"reply-btn",on:{click:t.reply}},[t._v("回复")]),t.removable?i("button",{staticClass:"remove-btn hidden",on:{click:function(e){t.isRemoveDialogVisible=!0}}},[t._v("删除")]):t._e()])]),t.isRemoveDialogVisible?i("confirm-dialog",{attrs:{title:"确认要删除这条回复吗？",content:""},on:{confirm:t.remove,cancel:function(e){t.isRemoveDialogVisible=!1}}}):t._e()],1)},staticRenderFns:[]}},1079:function(t,e,i){function n(t){i(1080)}var s=i(8)(i(1081),i(1082),n,"data-v-2c38f2aa",null);t.exports=s.exports},1080:function(t,e){},1081:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(158),s=i.n(n),o=i(75);e.default={props:["current","total"],computed:{canPrev:function(){return this.current>1},canNext:function(){return this.current<this.total},list:function(){var t=this.current,e=this.total;return e<=6?Object(o.a)(1,e):t<=4?[].concat(s()(Object(o.a)(1,4)),[!1,e]):t>=e-4?[1,!1].concat(s()(Object(o.a)(e-4,e))):[1,!1,t,t+1,!1,e]}},methods:{prev:function(){this.update(this.current-1)},next:function(){this.update(this.current+1)},update:function(t){this.$emit("update",t)},onItemClick:function(t){t&&this.update(t)}}}},1082:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ul",{staticClass:"pagination"},[t.canPrev?i("li",{staticClass:"item",on:{click:t.prev}},[t._v("上一页")]):t._e(),t._l(t.list,function(e){return i("li",{staticClass:"item",class:{ellipsis:!e,current:e==t.current},on:{click:function(i){t.onItemClick(e)}}},[t._v(t._s(e||"..."))])}),t.canNext?i("li",{staticClass:"item",on:{click:t.next}},[t._v("下一页")]):t._e()],2)},staticRenderFns:[]}},1083:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"subCommentBox",staticClass:"sub-comment-box",class:{"sub-comment-box__m":t.isMobile}},[i("div",{staticClass:"sub-comment-box__top"},[i("div",{staticClass:"icon-close",on:{click:t.close}}),i("h3",[t._v("评论")])]),i("div",{ref:"subCommentBoxInner",staticClass:"sub-comment-box__inner"},[t.empty?i("div",{staticClass:"empty-comment"},[t._m(0)]):i("div",[i("ul",{staticClass:"sub-comment-list"},t._l(t.list,function(e){return i("li",{key:e.id,staticClass:"item"},[i("sub-comment",{staticClass:"sub-comment",class:{"sub-comment__m":t.isMobile},attrs:{comment:e,tarUser:t.getTarUser(e),removable:t.removable},on:{reply:function(i){t.prepareReply(e)},remove:function(i){t.remove(e)}}})],1)})),t.totalPage>1?i("pagination",{staticClass:"pagination",attrs:{total:t.totalPage,current:t.page},on:{update:t.gotoPage}}):t._e()],1),i("form",{staticClass:"reply-form",on:{submit:function(t){t.preventDefault()},keyup:function(e){e.stopPropagation(),t.listenerKeyup(e)},keydown:t.listenerKeykown}},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.replyForm.content,expression:"replyForm.content"}],ref:"replyInput",attrs:{rows:"1",maxlength:"1024",placeholder:t.replyPlaceholder},domProps:{value:t.replyForm.content},on:{keyup:t.quickSubmit,input:function(e){e.target.composing||t.$set(t.replyForm,"content",e.target.value)}}}),i("button",{staticClass:"reply-btn",on:{click:t.onReplyBtnClick}},[t._v(t._s(t.replyBtnTitle))])])])])},staticRenderFns:[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("dl",[n("dt",[n("img",{attrs:{src:i(1084)}})]),n("dd",[t._v("暂无评论")])])}]}},1084:function(t,e){t.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+MTEyODdEMEYtNDY1MS00ODkzLUI5MTUtNDY0OTYyRDMwRDk5PC90aXRsZT48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0wIDBoNjB2NjBIMHoiLz48cGF0aCBkPSJNMTEgMzl2NS41bDcuMDcxLTUuNWgyMC45MjJBMyAzIDAgMCAwIDQyIDM2LjAwNlYxMi45OTRBMyAzIDAgMCAwIDM4Ljk5MyAxMEg5LjAwN0EzIDMgMCAwIDAgNiAxMi45OTR2MjMuMDEyQTMgMyAwIDAgMCA5LjAwNyAzOUgxMXoiIGZpbGw9IiNGMkY0RjUiLz48cGF0aCBkPSJNNTAgNDV2NS41TDQyLjkyOSA0NUgyMi4wMDdBMyAzIDAgMCAxIDE5IDQyLjAwNlYxOC45OTRBMyAzIDAgMCAxIDIyLjAwNyAxNmgyOS45ODZBMyAzIDAgMCAxIDU1IDE4Ljk5NHYyMy4wMTJBMyAzIDAgMCAxIDUxLjk5MyA0NUg1MHoiIGZpbGw9IiNEQ0RERTAiLz48cGF0aCBkPSJNNDYuNDkxIDI4SDI3LjUxQTEuNTA0IDEuNTA0IDAgMCAxIDI2IDI2LjVjMC0uODI5LjY3NS0xLjUgMS41MDktMS41SDQ2LjQ5Yy44MzQgMCAxLjUwOS42NzEgMS41MDkgMS41cy0uNjc1IDEuNS0xLjUwOSAxLjVNMjcuNTA5IDM2QTEuNTA0IDEuNTA0IDAgMCAxIDI2IDM0LjVjMC0uODI5LjY3NS0xLjUgMS41MDktMS41SDQwLjQ5Yy44MzQgMCAxLjUwOS42NzEgMS41MDkgMS41cy0uNjc1IDEuNS0xLjUwOSAxLjVIMjcuNTF6IiBmaWxsPSIjRjJGNEY2Ii8+PC9nPjwvc3ZnPg=="},1085:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"comment"},[i("user-popover",{attrs:{userId:t.comment.user.id}},[i("app-link",{attrs:{to:t.$userRoute(t.comment.user),blank:!0}},[i("avatar",{staticClass:"avatar",attrs:{user:t.comment.user,decorative:!0}})],1)],1),i("div",{staticClass:"content-box"},[i("div",{staticClass:"header"},[i("div",{staticClass:"user-info"},[i("user-popover",{attrs:{userId:t.comment.user.id}},[i("app-link",{staticClass:"username",attrs:{to:t.$userRoute(t.comment.user),blank:!0}},[t._v(t._s(t.comment.user.username))])],1),i("div",{staticClass:"position"},[t._v(t._s(t.$userPosition(t.comment.user)))])],1)]),i("div",{staticClass:"content"},[t.comment.reply?i("span",[t._v("回复"),i("router-link",{attrs:{to:t.$userRoute(t.comment.reply.user)}},[i("span",{staticClass:"username"},[t._v(t._s(t.comment.reply.user.username))])]),t._v("：")],1):t._e(),t.collapsed?i("span",{staticClass:"content-html collapsed"},[t._v(t._s(t.limitedContent))]):i("span",{directives:[{name:"parse-url",rawName:"v-parse-url",value:t.comment.content,expression:"comment.content"}],staticClass:"content-html"}),t.collapsed?i("span",{staticClass:"show-all",on:{click:function(e){t.isShowAll=!0}}},[t._v("展开全部")]):t._e()]),i("div",{staticClass:"footer"},[i("button",{staticClass:"like-btn",class:{liked:t.comment.liked},on:{click:t.toggleLike}},[i("i",{staticClass:"collection-arrow-ion ion-arrow-up-b"}),i("span",[t._v(t._s(t.displayedLikeCount))])]),i("span",{staticClass:"sub-comment-btn text-pointer",on:{click:t.toggleSubCommentBox}},[i("span",{staticClass:"title"},[t._v(t._s(t.toggleSubCommentBtnTitle))]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isSubCommentBoxActive,expression:"isSubCommentBoxActive"}],staticClass:"sub-comment--arrow"})]),i("span",{staticClass:"date"},[t._v(t._s(t.date))]),t.removable?i("button",{staticClass:"remove-btn hidden",on:{click:function(e){t.isRemoveDialogVisible=!0}}},[t._v("删除")]):t._e()]),t.isSubCommentBoxActive?i("sub-comment-box",{staticClass:"sub-comment-box",attrs:{parent:t.comment,entry:t.entry,type:t.type,removable:t.removable,"auto-unfold":t.autoUnfold},on:{"update:auto-unfold":t.updateAutoUnfold,close:function(e){t.isSubCommentBoxActive=!1}}}):t._e()],1),t.isRemoveDialogVisible?i("confirm-dialog",{attrs:{title:"你确定要删除这条评论吗？",content:"删除评论后，评论下的所有回复都会被删除"},on:{confirm:t.remove,cancel:function(e){t.isRemoveDialogVisible=!1}}}):t._e()],1)},staticRenderFns:[]}},1086:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ul",{ref:"list",staticClass:"comment-list",attrs:{"st:block":"commentList"}},[t._l(t.list,function(e,n){return i("li",{key:n,staticClass:"item"},[i("comment",{attrs:{comment:e,entry:t.entry,type:t.type,removable:t.removable},on:{remove:function(i){t.remove(e)}}})],1)}),t.manual?i("li",{staticClass:"more"},[i("div",{staticClass:"more-btn",class:{loading:t.loading},on:{click:t.fetchMore}},[t._v(t._s(t.loading?"加载中...":"展开全部"))])]):t._e()],2)},staticRenderFns:[]}},1100:function(t,e,i){/**
 * juejin-lazyload v0.1.5
 * (c) 2017 WEBuster <webuster@xitu.io>
 * @license MIT
 */
!function(e,i){t.exports=i()}(0,function(){"use strict";function t(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t.addEventListener(e,i,n),function(){t.removeEventListener(e,i,n)}}!function(){function t(t){this.value=t}function e(e){function i(s,o){try{var a=e[s](o),r=a.value;r instanceof t?Promise.resolve(r.value).then(function(t){i("next",t)},function(t){i("throw",t)}):n(a.done?"return":"normal",a.value)}catch(t){n("throw",t)}}function n(t,e){switch(t){case"return":s.resolve({value:e,done:!0});break;case"throw":s.reject(e);break;default:s.resolve({value:e,done:!1})}(s=s.next)?i(s.key,s.arg):o=null}var s,o;this._invoke=function(t,e){return new Promise(function(n,a){var r={key:t,arg:e,resolve:n,reject:a,next:null};o?o=o.next=r:(s=o=r,i(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}();var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},s={threshold:0,interval:200,debounce:!1,reactive:!0,eagerShowing:!1,infoGetter:null,visibleAreaGetter:null,onStateChange:null},o="__JUEJIN_LAZYLOAD";return function(){function a(t,i){e(this,a),this.setOptions(i),this.addOrUpdateElement(t),this.initEventListener()}return i(a,[{key:"setOptions",value:function(t){this.options=n({},s,t)}},{key:"initEventListener",value:function(){var e=this;if(this.options.reactive){var i=this.options.debounce?function(t,e){var i=0;return function(){for(var n=this,s=arguments.length,o=Array(s),a=0;a<s;a++)o[a]=arguments[a];clearTimeout(i),i=setTimeout(function(){return t.apply(n,o)},e)}}(function(){return e.updateState()},this.options.interval):function(t,e){var i=0;return e/=2,function(){for(var n=arguments.length,s=Array(n),o=0;o<n;o++)s[o]=arguments[o];Date.now()-i>=e&&(i=Date.now(),setTimeout(function(){t.apply(null,s)},e))}}(function(){return e.updateState()},this.options.interval);this.removeScrollEventListener=t(window,"scroll",i),this.removeResizeEventListener=t(window,"resize",i)}}},{key:"removeEventListener",value:function(){this.removeScrollEventListener&&this.removeScrollEventListener(),this.removeResizeEventListener&&this.removeResizeEventListener()}},{key:"addOrUpdateElement",value:function(t){var e=this.getElementList(t),i=e.filter(function(t){return!t[o]});this.elementList=(this.elementList||[]).concat(i),e.forEach(this.initElement.bind(this)),this.updateState()}},{key:"removeElement",value:function(t){var e=this.getElementList(t);this.elementList=this.elementList.filter(function(t){return-1===e.indexOf(t)}),e.forEach(this.removeInfo.bind(this))}},{key:"clean",value:function(){this.elementList.forEach(this.removeInfo.bind(this)),this.elementList=[]}},{key:"getElementList",value:function(t){return t?"string"==typeof t?[].slice.call(document.querySelectorAll(t)):"number"==typeof t.length?[].slice.call(t):[t]:[]}},{key:"initElement",value:function(t){this.attachInfo(t),this.setPlaceholder(t),this.updateElementClassByState("inited",t),this.invokeStateHook("inited",t)}},{key:"attachInfo",value:function(t){var e=this.options.infoGetter&&this.options.infoGetter(t),i=n({},e,{loading:!1});t[o]=i}},{key:"setPlaceholder",value:function(t){var e=t[o];"IMG"===t.nodeName&&e.width&&e.height&&(t.src=function(t,e){return["data:image/svg+xml;utf8,",'<?xml version="1.0"?>','<svg xmlns="http://www.w3.org/2000/svg" version="1.1" ','width="'+t+'" height="'+e+'"',"></svg>"].join("")}(e.width,e.height))}},{key:"removeInfo",value:function(t){t[o]&&(t[o]=null)}},{key:"updateState",value:function(){var t=this;if(this.elementList.length){var e=this.getActiveArea();this.elementList.forEach(function(i){var n=i[o].loading,s=i.getBoundingClientRect(),a=function(t,e){return!(e.bottom<t.top||e.top>t.bottom||e.right<t.left||e.left>t.right)}(e,s);!n&&a&&t.loadIamge(i)})}}},{key:"getActiveArea",value:function(){var t=this.getVisibleArea(),e=this.options.threshold||0;return{top:t.top-e,left:t.left-e,right:t.right+e,bottom:t.bottom+e}}},{key:"getVisibleArea",value:function(){if(this.options.visibleAreaGetter)return this.options.visibleAreaGetter();var t=function(){var t=document.documentElement;return{width:Math.max(t.clientWidth,window.innerWidth||0),height:Math.max(t.clientHeight,window.innerHeight||0)}}();return{top:0,left:0,right:t.width,bottom:t.height}}},{key:"loadIamge",value:function(t){var e=this,i=t[o],n=i.url;i.loading=!0,this.updateElementClassByState("loading",t),this.invokeStateHook("loading",t),function(t,e){var i=e.onStart,n=e.onLoaded,s=e.onError,o=new Image;o.onload=function(){n&&n(t,o)},o.onerror=function(){s&&s(t,o)},o.src=t,i&&i(t,o)}(n,{onStart:function(i,n){e.options.eagerShowing&&e.onMetaLoaded(n,function(){t.removeAttribute("src"),t.setAttribute("src",i)})},onLoaded:function(){e.setElementWithImageUrl(n,t),e.updateElementClassByState("loaded",t),e.invokeStateHook("loaded",t),e.removeElement(t)},onError:function(){e.updateElementClassByState("error",t),e.invokeStateHook("error",t),e.removeElement(t)}})}},{key:"updateElementClassByState",value:function(t,e){switch(t){case"inited":e.classList.add("inited"),e.classList.remove("loading"),e.classList.remove("loaded"),e.classList.remove("error");break;case"loading":e.classList.add("loading");break;case"loaded":e.classList.remove("loading"),e.classList.add("loaded");break;case"error":e.classList.remove("loading"),e.classList.add("error")}}},{key:"invokeStateHook",value:function(t,e){if(this.options.onStateChange){var i=e[o].url;this.options.onStateChange(t,i,e,this)}}},{key:"setElementWithImageUrl",value:function(t,e){"IMG"===e.nodeName?e.src=t:e.style.backgroundImage="url("+t+")"}},{key:"onMetaLoaded",value:function(e,i){var n=setInterval(function(){e.naturalWidth&&(s(),i())},300),s=function(){return clearInterval(n)};t(e,"load",s),t(e,"error",s)}},{key:"destroy",value:function(){this.removeEventListener(),this.clean(),this.setOptions({})}}]),a}()})},1121:function(t,e,i){function n(t){i(1122)}var s=i(8)(i(1123),i(1139),n,"data-v-d7096830",null);t.exports=s.exports},1122:function(t,e){},1123:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(3),s=i.n(n),o=i(94),a=i.n(o),r=i(10),c=i(58),u=(i(31),i(34)),l=i(160),d=i(1124),m=i.n(d),f=i(1129),h=i.n(f);e.default={components:{PaymentQrCode:m.a,PaymentDialog:h.a},data:function(){return{paymentStep:"PaymentDialog",show:!1,payParams:{},info:{id:null,title:"",price:0}}},computed:a()({},Object(c.mapGetters)({logined:r.LOGINED}),{isMobileBrowser:function(){return Object(u.d)()},isWechat:function(){return Object(u.c)()},payWay:function(){return this.isWechat?l.c:this.isMobileBrowser?l.a:l.b}}),methods:{close:function(){this.show=!1,this.paymentStep="PaymentDialog"},prev:function(){this.step("prev")},next:function(t){this.step("next",t)},step:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"prev"===t&&(this.paymentStep="PaymentDialog"),"next"===t&&(this.$getBean("xiaoceBusiness").storagePaymengtStatus(this.payWay),this.payWay===l.b?(this.paymentStep="PaymentQrCode",this.payParams=e):this.$getBean("xiaoceBusiness").toAppPay({payWay:this.payWay,metaId:this.info.id,promotionType:e.type,promotionParams:e.params,adLinkSrc:e.adLinkSrc}))}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.BOOK_PAYMENT,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.logined)t.show=!0,t.info=s()({adLinkSrc:{source:"",discount:10}},e);else{var i=t.$getBean("eventBus");i.emit(i.eventType.AUTH_WECHAT_QUICK_LOGIN)}})}}},1124:function(t,e,i){function n(t){i(1125)}var s=i(8)(i(1126),i(1127),n,"data-v-328c7a30",null);t.exports=s.exports},1125:function(t,e){},1126:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(966),s=i(160);e.default={props:["info","payParams"],data:function(){return{payQrCode:"",checkTimer:null}},methods:{prev:function(){this.$emit("prev")},buyBook:function(){var t=this,e=this.payParams.metaId,i=this.payParams.type,s=this.payParams.params,o=this.payParams.adLinkSrc;this.$getBean("xiaoceBusiness").getWechatPayQrCode({metaId:e,promotionType:i,promotionParams:s,adLinkSrc:o}).then(function(e){t.payQrCode=Object(n.a)(e),t.$nextTick(function(){t.checkBuyBook()})}).catch(function(e){t.$alert(e)})},closePayment:function(){clearTimeout(this.closeTimer)},cancelCheckPay:function(){clearInterval(this.checkTimer)},checkBuyBook:function(){var t=this,e=this.info.id;this.checkTimer=setInterval(function(){t.$getBean("xiaoceBusiness").checkBuyBook(e).then(function(i){t.cancelCheckPay(),t.$emit("close"),window.location.href="/book/"+e+"?paymentStatus="+s.b})},4e3),this.closeTimer=setTimeout(function(){t.cancelCheckPay(),t.$emit("close"),t.$alert("交易关闭")},3e5)}},beforeDestroy:function(){this.closePayment(),this.cancelCheckPay()},mounted:function(){this.buyBook()}}},1127:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"payment-qr-code"},[i("div",{staticClass:"heading"},[i("div",{staticClass:"back",on:{click:t.prev}}),i("div",{staticClass:"title"},[t._v(t._s(t.info.title))])]),i("div",{staticClass:"qr-img"},[i("img",{attrs:{src:t.payQrCode}})]),t._m(0)])},staticRenderFns:[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"bottom"},[n("img",{attrs:{src:i(1128)}}),n("span",[t._v("微信扫码支付")])])}]}},1128:function(t,e){t.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBmaWxsPSJjdXJyZW50Q29sb3IiIGNsYXNzPSJQYXltZW50RGlhbG9nLXdlY2hhdEljb24tMUphcCIgZGF0YS1uYW1lPSJ3ZWNoYXQtb2siPjx0aXRsZT53ZWNoYXRfcGF5PC90aXRsZT48cGF0aCBkPSJNOC42OCAxNC42MjRhLjc3NC43NzQgMCAwIDEtLjM1OC4wODguNzk0Ljc5NCAwIDAgMS0uNjk0LS40MTZsLS4wNS0uMTE4LTIuMTc0LTQuODc1YS40MDMuNDAzIDAgMCAxIC4zNi0uNTc4Yy4wOSAwIC4xNy4wMy4yMzguMDhsMi41NjMgMS44NjhhMS4xNjMgMS4xNjMgMCAwIDAgMS4wNi4xMjRsMTIuMDU3LTUuNDg4QzE5LjUyMiAyLjcwMyAxNS45NjIgMSAxMS45MzQgMSA1LjM0NCAxIDAgNS41NTQgMCAxMS4xNzJjMCAzLjA2NSAxLjYwOCA1LjgyNCA0LjEyMyA3LjY4OGEuODIxLjgyMSAwIDAgMSAuMjkzLjkyM2wtLjUzOCAyLjA1Yy0uMDI1LjA5Ny0uMDY0LjE5OC0uMDY0LjMgMCAuMjIzLjE3OC40MDUuMzk4LjQwNWEuNDQ3LjQ0NyAwIDAgMCAuMjMtLjA3NmwyLjYxMi0xLjU0MmMuMTk3LS4xMTYuNDA0LS4xODguNjM0LS4xODguMTIyIDAgLjI0LjAyLjM1LjA1NCAxLjIyLjM1OCAyLjUzNC41NTggMy44OTYuNTU4IDYuNTkgMCAxMS45MzQtNC41NTQgMTEuOTM0LTEwLjE3MiAwLTEuNzAyLS40OTMtMy4zMDQtMS4zNi00LjcxNEw4Ljc3IDE0LjU3M2wtLjA4Ny4wNXoiIGZpbGw9IiMwMEM4MDAiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PC9wYXRoPjwvc3ZnPg=="},1129:function(t,e,i){function n(t){i(1130)}var s=i(8)(i(1131),i(1136),n,"data-v-0b599438",null);t.exports=s.exports},1130:function(t,e){},1131:function(t,e,i){"use strict";function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{hasSale:!1,realityPrice:null,discountRate:null};return{hasSale:t.hasSale,realityPrice:t.realityPrice,discountRate:t.discountRate}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(5),o=i.n(s),a=i(3),r=i.n(a),c=i(94),u=i.n(c),l=i(10),d=i(1132),m=i.n(d),f=i(58),h=i(971),p=i(160);e.default={props:["info","payWay"],components:{Conpon:m.a},data:function(){return{aliPay:p.a,disabledId:"5b30c3b351882574957a788f",visibleConpon:!1,discountType:"none",selfDistributorInfo:{isDistributor:!1,discount:{}},newuserTicketInfo:{isExpired:!0,restCount:0},payWayParams:{newuser:{sale:5,type:"newUserDiscountTicket",params:{}},reward:{sale:10,type:"distributor",params:{distributorUid:null,distributorDiscount:null}},promocode:{sale:10,type:"discount",params:{discount:null}},timelimit:{sale:10,type:"",params:{}},none:{sale:10,type:"none",params:{}}},hasInviterDiscount:!1,saleInfo:n()}},watch:{discountType:function(t){var e=10;"promocode"===t?10===(e=this.payWayParams.promocode.sale)&&(this.visibleConpon=!0):e="reward"===t?this.payWayParams.reward.sale:"newuser"===t?this.payWayParams.newuser.sale:"timelimit"===t?this.payWayParams.timelimit.sale:10,this.computeSale(e)},selfDistributorInfo:function(t){var e=Object(h.b)(t.discount),i=t.isDistributor&&e<10;this.isNewuser&&this.setDiscountType("newuser"),i&&(this.setDiscountType("reward",!0),this.hasInviterDiscount=i,this.payWayParams.reward.sale=e,this.payWayParams.reward.params.distributorUid=this.user.id,this.payWayParams.reward.params.distributorDiscount=e)}},filters:{f_saleText:function(t){t=parseFloat(t);return t>0?t+"折":"免费"}},computed:u()({},Object(f.mapGetters)({user:l.USER}),{timelimitInfo:function(){return Object(h.c)(this.info)},adLinkSrcInfo:function(){return this.info.adLinkSrc},isNewuser:function(){var t=+new Date(this.newuserTicketInfo.serverTimeAt),e=+new Date(this.newuserTicketInfo.createdAt),i=(t-e)/864e5,n=i<7&&i>0;return!this.newuserTicketInfo.isNewUser&&n&&this.newuserTicketInfo.restCount>0&&!this.newuserTicketInfo.isExpired},hasTimelimit:function(){return this.payWayParams.timelimit.sale<10},hasSourceDiscount:function(){return this.adLinkSrcInfo.hasSourceDiscount},hasPromocodeDiscount:function(){return this.payWayParams.promocode.sale<10}}),methods:{setDiscountType:function(t){(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||"none"===this.discountType)&&(this.discountType=t)},submitPromocode:function(t,e){this.visibleConpon=!1,this.setDiscountType("promocode",!0),this.payWayParams.promocode.sale=e,this.payWayParams.promocode.params.discount=t,this.computeSale(e)},computeSale:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=Object(h.a)(this.info.price,t),i=t<10;this.saleInfo=n({hasSale:i,discountRate:t,realityPrice:e})},openConpon:function(){this.visibleConpon=!0},closeConpon:function(){this.visibleConpon=!1},close:function(){this.$emit("close")},next:function(){var t=this,e="",i=this.info.id,n=this.saleInfo.realityPrice,s=this.discountType||"none";"promocode"===s&&10===this.payWayParams.promocode.sale&&(s="none"),this.hasSourceDiscount&&(e=this.adLinkSrcInfo.source);var o=r()({metaId:i,adLinkSrc:e},this.payWayParams[s]);if(n>0)this.$emit("next",o);else{var a=this.payWay;this.$getBean("xiaoceBusiness").storagePaymengtStatus(a),this.$getBean("xiaoceBusiness").freeDiscount({payWay:a,metaId:i,promotionType:o.type,promotionParams:o.params,adLinkSrc:e}).then(function(e){window.location.href="/book/"+t.info.id+"?paymentStatus="+t.payWay})}},getNewuserTicket:function(){return this.$getBean("xiaoceBusiness").getNewUserTicketDetail()},getSelfDistributorInfo:function(){return this.$getBean("xiaoceBusiness").getSelfDistributorInfo({uid:this.user.id})},initTimelimitDiscount:function(){this.computeSale(10);var t=this.timelimitInfo,e=t.sale,i=t.type;e>=0&&e<10&&(this.setDiscountType("timelimit"),this.payWayParams.timelimit.type=i,this.payWayParams.timelimit.sale=e)},initDiscount:function(){var t=this;this.initTimelimitDiscount(),o.a.all([this.getSelfDistributorInfo(),this.getNewuserTicket()]).then(function(e){t.selfDistributorInfo=e[0],t.newuserTicketInfo=e[1]})}},mounted:function(){var t=this.adLinkSrcInfo,e=t.hasSourceDiscount,i=t.discount;e?this.computeSale(i):this.initDiscount()}}},1132:function(t,e,i){function n(t){i(1133)}var s=i(8)(i(1134),i(1135),n,"data-v-5fe21a36",null);t.exports=s.exports},1133:function(t,e){},1134:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(34);e.default={data:function(){return{inputStatus:"",code:"",errorMsg:""}},props:["id"],computed:{isMobileBrowser:function(){return Object(n.d)()},conponClass:function(){return this.isMobileBrowser?"conpon-inner--"+this.inputStatus:""}},watch:{code:function(t){return t.trim()}},methods:{conponFocus:function(){this.inputStatus="focus"},conponBlur:function(){this.inputStatus="blur"},cancel:function(){this.$emit("close")},check:function(){var t=this,e=this.code.trim();""===e?this.errorMsg="折扣码不能为空！":this.$getBean("xiaoceBusiness").checkDiscount({metaId:this.id,code:e}).then(function(e){if(e.isOk){var i=e.discountRate;t.$emit("submit",t.code,i)}else t.errorMsg=e.message||"优惠码错误，请重新输入"})}},mounted:function(){this.$refs.saleInput.focus()}}},1135:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"conpon-wrap"},[i("div",{staticClass:"conpon-masker"}),i("div",{staticClass:"conpon-inner",class:t.conponClass},[i("div",{staticClass:"heading"},[t._v("请输入优惠码")]),i("div",{staticClass:"content"},[i("div",{staticClass:"conpon-input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.code,expression:"code"}],ref:"saleInput",attrs:{autofocus:"autofocus"},domProps:{value:t.code},on:{focus:t.conponFocus,blur:t.conponBlur,keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.check(e)},input:function(e){e.target.composing||(t.code=e.target.value)}}}),t.errorMsg?i("div",{staticClass:"state-text"},[t._v(t._s(t.errorMsg))]):t._e()])]),i("div",{staticClass:"footer"},[i("div",{staticClass:"btn cancel",on:{click:t.cancel}},[t._v("取消")]),i("div",{staticClass:"btn ok",on:{click:t.check}},[t._v("确定")])])])])},staticRenderFns:[]}},1136:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"payment-dialog"},[n("div",{staticClass:"cell"},[n("span",{staticClass:"close-btn",on:{click:t.close}}),n("div",{staticClass:"title"},[t._v(t._s(t.info.title))]),n("div",{staticClass:"price"},[n("span",{staticClass:"name"},[t._v("支付总额")]),t.saleInfo.hasSale?n("div",{staticClass:"price-sale"},[n("div",{staticClass:"span rmb"},[t._v("￥"+t._s(t.saleInfo.realityPrice))]),n("div",{staticClass:"span delete"},[t._v("￥"+t._s(t.info.price))]),!t.hasPromocodeDiscount||t.isNewuser||t.hasInviterDiscount||t.hasTimelimit?n("span",{staticClass:"sale-card"},[t._v(t._s(t._f("f_saleText")(t.saleInfo.discountRate)))]):t._e()]):n("div",{staticClass:"price-default"},[n("div",{staticClass:"span rmb"},[t._v("￥"+t._s(t.info.price))])])]),n("div",{staticClass:"pay-way"},[n("span",{staticClass:"name"},[t._v("支付方式")]),t.payWay===t.aliPay?n("span",{staticClass:"ali-pay"},[n("img",{attrs:{src:i(1137)}}),t._v("支付宝支付")]):n("span",{staticClass:"wx-pay"},[n("img",{attrs:{src:i(1138)}})])]),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.hasSourceDiscount,expression:"!hasSourceDiscount"}],staticClass:"pay-sale"},[n("span",{staticClass:"name"},[t._v("使用优惠")]),t.hasPromocodeDiscount||t.isNewuser||t.hasInviterDiscount||t.hasTimelimit?n("div",{staticClass:"sale-choose"},[t.isNewuser?n("label",{staticClass:"sale-item"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.discountType,expression:"discountType"}],attrs:{type:"radio",id:"discount-id-newuser",value:"newuser"},domProps:{checked:t._q(t.discountType,"newuser")},on:{change:function(e){t.discountType="newuser"}}}),n("span",{staticClass:"text"},[t._v("新人券")])]):t._e(),t.hasInviterDiscount?n("label",{staticClass:"sale-item"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.discountType,expression:"discountType"}],attrs:{type:"radio",id:"discount-id-reward",value:"reward"},domProps:{checked:t._q(t.discountType,"reward")},on:{change:function(e){t.discountType="reward"}}}),n("span",{staticClass:"text"},[t._v("推荐奖励")])]):t._e(),t.hasTimelimit?n("label",{staticClass:"sale-item"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.discountType,expression:"discountType"}],attrs:{type:"radio",id:"discount-id-timelimit",value:"timelimit"},domProps:{checked:t._q(t.discountType,"timelimit")},on:{change:function(e){t.discountType="timelimit"}}}),n("span",{staticClass:"text"},[t._v("限时优惠")])]):t._e(),n("div",{staticClass:"sale-item"},[t.isNewuser||t.hasInviterDiscount||t.hasTimelimit?n("input",{directives:[{name:"model",rawName:"v-model",value:t.discountType,expression:"discountType"}],attrs:{type:"radio",id:"discount-id-promocode",value:"promocode"},domProps:{checked:t._q(t.discountType,"promocode")},on:{change:function(e){t.discountType="promocode"}}}):t._e(),t.isNewuser||t.hasInviterDiscount||t.hasTimelimit?n("label",{staticClass:"text",attrs:{for:"discount-id-promocode"},on:{click:function(e){t.visibleConpon=!0}}},[t._v("优惠码")]):t._e(),!t.hasPromocodeDiscount||t.isNewuser||t.hasInviterDiscount||t.hasTimelimit?t._e():n("span",{staticClass:"sale-card disabled",on:{click:function(e){t.visibleConpon=!0}}},[t._v(t._s(t._f("f_saleText")(t.payWayParams.promocode.sale)))])])]):n("div",{staticClass:"sale-choose"},[n("div",{staticClass:"sale-item",on:{click:function(e){t.visibleConpon=!0}}},[n("span",{staticClass:"not-sale"},[t._v("输入优惠码")])])])]),n("div",{staticClass:"pay-bar"},[t.info.id!==t.disabledId?n("button",{staticClass:"button--buy",on:{click:t.next}},[t._v("确认支付")]):n("button",{staticClass:"button--buy",attrs:{disabled:"disabled"}},[t._v("停止销售")])])]),t.visibleConpon?n("conpon",{attrs:{id:t.info.id},on:{close:t.closeConpon,submit:t.submitPromocode}}):t._e()],1)},staticRenderFns:[]}},1137:function(t,e,i){t.exports=i.p+"static/img/ali-pay-logo.a251946.png"},1138:function(t,e,i){t.exports=i.p+"static/img/wx-pay-logo.2a9abb4.png"},1139:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.show?i("div",{staticClass:"payment-wrap"},[i("div",{staticClass:"payment-masker"}),i("div",{staticClass:"payment-inner"},[i("transition",{attrs:{name:"fade",mode:"out-in"}},[i(t.paymentStep,{tag:"component",attrs:{info:t.info,"pay-way":t.payWay,"pay-params":t.payParams},on:{close:t.close,prev:t.prev,next:t.next}})],1)],1)]):t._e()},staticRenderFns:[]}},1272:function(t,e,i){function n(t){i(1273)}var s=i(8)(i(1274),i(1287),n,"data-v-decff8c4",null);t.exports=s.exports},1273:function(t,e){},1274:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1275),s=i.n(n),o=i(1279),a=i.n(o),r=i(1283),c=i.n(r);e.default={components:{SectionBuyingGuide:s.a,SectionWriting:a.a,SectionContent:c.a},props:["bookInfo","sectionInfo","user","free"],data:function(){return{}},computed:{isAdmin:function(){var t=this.user||{},e="admin"===t.role,i=this.author.uid===t.id;return e||i},author:function(){var t=this.bookInfo;return t&&t.user||{}},viewComponent:function(){var t=this.sectionInfo;return t?t.isFinished||this.isAdmin?"content":"writing":"buying-guide"}},methods:{buy:function(){this.$emit("buy")}}}},1275:function(t,e,i){function n(t){i(1276)}var s=i(8)(i(1277),i(1278),n,"data-v-5d06e5a3",null);t.exports=s.exports},1276:function(t,e){},1277:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(964),s=i.n(n),o=i(971);e.default={props:["bookInfo"],components:{Thumb:s.a},computed:{isWapSection:function(){return"bookWapSection"===this.$route.name},timelimitInfo:function(){return Object(o.c)(this.bookInfo)},salePrice:function(){var t=this.bookInfo.price,e=this.timelimitInfo.sale;return this.hasSale&&(t=Object(o.a)(t,e)),t},hasSale:function(){return Object(o.d)(this.bookInfo)}},methods:{computeSalePrice:o.a,buy:function(){this.$emit("buy")}},mounted:function(){}}},1278:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"buying-guide-wrap"},[i("div",{staticClass:"buying-guide",class:{"buying-guide--m":t.isWapSection}},[i("div",{staticClass:"buying-inner"},[i("div",{staticClass:"poster"},[t.bookInfo.img?i("thumb",{staticClass:"thumb",attrs:{url:t.bookInfo.img,width:450,height:630}}):t._e()],1),i("div",{staticClass:"title"},[t._v("此章节为付费章节")]),i("div",{staticClass:"desc"},[t._v("现在购买立即解锁全部内容")]),i("button",{staticClass:"button-buy",on:{click:t.buy}},[t._v("立即购买 ￥"+t._s(t.salePrice))])])])])},staticRenderFns:[]}},1279:function(t,e,i){function n(t){i(1280)}var s=i(8)(i(1281),i(1282),n,"data-v-67d20023",null);t.exports=s.exports},1280:function(t,e){},1281:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(964),s=i.n(n);e.default={props:["bookInfo"],components:{Thumb:s.a},computed:{isWapSection:function(){return"bookWapSection"===this.$route.name}}}},1282:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"section-writing-wrap"},[i("div",{staticClass:"section-writing",class:{"section-writing--m":t.isWapSection}},[i("div",{staticClass:"writing-inner"},[i("div",{staticClass:"poster"},[t.bookInfo.img?i("thumb",{staticClass:"thumb",attrs:{url:t.bookInfo.img,width:450,height:630}}):t._e()],1),i("div",{staticClass:"title"},[t._v("此章节正在写作中")])])])])},staticRenderFns:[]}},1283:function(t,e,i){function n(t){i(1284)}var s=i(8)(i(1285),i(1286),n,"data-v-41acfafa",null);t.exports=s.exports},1284:function(t,e){},1285:function(t,e,i){"use strict";function n(t){if(t.length){return t.map(function(t){return t.createdAt}).sort(function(t,e){return t-e})[0]}return null}function s(t){return[].slice.call(t.querySelectorAll("h1,h2"))}Object.defineProperty(e,"__esModule",{value:!0});var o=i(158),a=i.n(o),r=i(3),c=i.n(r),u=i(94),l=i.n(u),d=i(1056),m=i.n(d),f=i(1064),h=i.n(f),p=i(31),v=i(10),g=i(58),y=i(96),b=i(34),C=i(987),I=i.n(C);e.default={components:{CommentForm:m.a,CommentList:h.a},props:["bookInfo","sectionInfo","free"],data:function(){return{canFetch:!0,commentList:[],commentTime:!1,query:{entryId:"",startTime:"",pageSize:20}}},watch:{$route:function(){this.fetch()},sectionInfo:{handler:function(t,e){t.id&&this.initHashToElement()},immediate:!0}},computed:l()({curSectionId:function(){return this.$route.params.sectionId},isLastSectionId:function(){var t=this.bookInfo.section;return(t.length>0?t[t.length-1]:0)===this.curSectionId},isMobileBrowser:function(){return Object(b.d)()},section:function(){return c()({},this.sectionInfo,{user:this.bookInfo.user})}},Object(g.mapGetters)({user:v.USER,login:v.LOGIN})),methods:{onContentElementClick:function(t){var e=this,i=t.target;if("copy-code-btn"===i.className){var n=i.textContent,s=i.parentNode,o=s.textContent.replace(n,"");I()(o).then(function(){e.$alert("代码复制成功")}).catch(function(){e.$error("一键复制失败，请手动复制")})}},getCommentList:function(){var t=this,e=this.curSectionId,i=c()(this.query,{entryId:e});this.canFetch&&(this.canFetch=!1,this.$getBean("xiaoceCommentBusiness").getCommentList(i).then(function(e){t.commentList=[].concat(a()(t.commentList),a()(e.list)),t.$nextTick(function(){e.list.length>0?(t.canFetch=!0,t.query.startTime=n(t.commentList)):t.canFetch=!1})}).catch(function(){t.canFetch=!0}))},onSubmittedComment:function(){this.commentList=[],this.query.startTime=null,this.canFetch=!0,this.getCommentList()},onShouldFetchMoreComment:function(){this.getCommentList()},setXiaoceSectionView:function(){var t=this.$route.params.id,e=this.curSectionId;e&&this.$getBean("xiaoceBusiness").setXiaoceSectionView({id:t,sectionId:e}).then(function(t){}).catch(function(){})},copyHandle:function(t){var e=window.getSelection().toString().trim();if(e.length>=120){t.preventDefault();var i=e.substring(0,1024)+"...\n";i=[i,"https://juejin.im","掘金 — 一个帮助开发者成长的社区"].join("\n"),t.clipboardData.setData("text/plain",i),t.clipboardData.setData("text/html",i)}},activeItemByCurrentPosition:function(t){if(t&&this.free){var e=s(t),i=e.map(function(t){return t.getBoundingClientRect().top}),n=document.documentElement.scrollTop+Object(p.c)().height,o=this.$refs.commentBox.offsetTop;if(this.isLastSectionId&&n>o)this.updateReadHistory({sectionId:"",sign:""});else for(var a=0;a<i.length;a++){var r=i[a],c=i[a+1];if(r<100&&(!c||c>100)){this.updateReadHistory({sectionId:this.curSectionId,sign:"#"+e[a].dataset.id});break}}}},updateReadHistory:function(t){var e=t.sectionId,i=t.sign,n=this.$route.params.id;this.$getBean("xiaoceBusiness").updateReadHistory({metaId:n,sectionId:e,sign:i})},initHashToElement:function(){var t=this;this.$nextTick(function(){var e=t.$route.hash;if(e)if("#comment"===e)t.$refs.commentForm.focus(),Object(p.j)(t.$refs.commentForm);else{var i=e.substring(1),n=t.$refs.content.querySelectorAll('[data-id="'+i+'"]')[0],s=t.isMobileBrowser?35:70,o=n.offsetTop;window.scrollTo(0,o-s)}})},fetch:function(){var t=this;this.setXiaoceSectionView(),this.commentTime=setTimeout(function(){t.getCommentList()},1500)}},mounted:function(){var t=this;this.fetch();var e=Object(y.a)(function(){t.activeItemByCurrentPosition(t.$refs.content)},500);setTimeout(function(){t.removeScrollEventListener=Object(p.g)(window,e,300)},3e3),this.removeCopyListener=Object(p.e)(document,"copy",function(e){t.copyHandle(e)})},beforeDestroy:function(){clearTimeout(this.commentTime),this.removeCopyListener()}}},1286:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"section-content"},[i("div",{staticClass:"section-page book-section-view"},[i("div",{ref:"content",staticClass:"entry-content article-content",domProps:{innerHTML:t._s(t.sectionInfo.html)},on:{"!click":function(e){t.onContentElementClick(e)}}}),t.sectionInfo.html?i("section",{ref:"commentBox",staticClass:"book-comments"},[i("div",{staticClass:"box-title"},[t._v("留言")]),i("div",{staticClass:"comment-box"},[i("comment-form",{ref:"commentForm",staticClass:"comment-form",attrs:{id:"comment",user:t.user,entry:t.section,type:"book",placeholder:"评论将在后台进行审核，审核通过后对所有人可见"},on:{submitted:t.onSubmittedComment}})],1),i("comment-list",{staticClass:"comment-list",attrs:{list:t.commentList,entry:t.section,type:"book"},on:{"should-fetch-more":t.onShouldFetchMoreComment}})],1):t._e()])])},staticRenderFns:[]}},1287:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"section-view"},["content"===t.viewComponent?i("section-content",{attrs:{free:t.free,"book-info":t.bookInfo,"section-info":t.sectionInfo}}):t._e(),"buying-guide"===t.viewComponent?i("section-buying-guide",{attrs:{"book-info":t.bookInfo},on:{buy:t.buy}}):t._e(),"writing"===t.viewComponent?i("section-writing",{attrs:{"book-info":t.bookInfo}}):t._e()],1)},staticRenderFns:[]}},1572:function(t,e){},1573:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(5),s=i.n(n),o=i(3),a=i.n(o),r=i(94),c=i.n(r),u=i(31),l=i(10),d=i(58),m=i(1100),f=i.n(m),h=i(1272),p=i.n(h),v=i(1574),g=i.n(v),y=i(1578),b=i.n(y),C=i(1050),I=i.n(C),w=i(1121),M=i.n(w),k=i(1585),x=i.n(k),_=i(1594),L=i.n(_),D=i(226),T=i.n(D);e.default={components:{UserAuth:L.a,ImageViewer:T.a,BookDirectory:x.a,BookDirection:b.a,BookProgress:g.a,WechatQuickLogin:I.a,BookPaymentPopup:M.a,SectionPrev:p.a,SectionNext:p.a},data:function(){return{sectionError:!1,sectionList:[],bookInfo:null,sectionInfo:{},direction:"next",view:"prev",unfoldM:!1,foldPc:!1,isViewNavOnTop:!1,isHeaderVisible:!0,needHide:!1,qrHide:!1}},computed:c()({},Object(d.mapGetters)({user:l.USER,logined:l.LOGINED}),{isAdmin:function(){var t=this.user||{},e="admin"===t.role,i=this.author.uid===t.id;return e||i},canPayment:function(){var t=this.bookInfo,e=t.price,i=t.isBuy,n=t.isEditor;return e>0&&!i&&!n},directionClass:function(){return"prev"===this.direction?"transition--prev":"transition--next"},bookId:function(){return this.$route.params.id},sectionId:function(){return this.$route.params.sectionId},filterList:function(){var t=this;return this.isAdmin?this.sectionList.map(function(t){return t.sectionId}).filter(function(t){return t}):this.sectionList.map(function(e){return!(!t.free&&!e.isFree||!e.isFinished)&&e.sectionId}).filter(function(t){return t})},sectionIdList:function(){return this.bookInfo&&this.bookInfo.section||[]},curDirectoryIndex:function(){return this.sectionIdList&&this.sectionIdList.indexOf(this.sectionId)},curFreeDirectoryIndex:function(){var t=this.$route.params.sectionId;return this.filterList.indexOf(t)},free:function(){var t=this.bookInfo,e=t.price,i=t.isBuy;return 0===e||i},author:function(){var t=this.bookInfo;return t&&t.user||{}}}),watch:{$route:function(){this.bookInfo||this.fetch(),this.getSection(),this.loopComponent()}},shareInfo:function(){var t=this.bookInfo||{};return{title:t.title+" - "+this.author.username+" - 掘金小册",noTemplate:!0,description:t.desc,thumb:t.img,url:this.$route.fullPath}},metaInfo:function(){var t=this.bookInfo&&this.bookInfo.title||"",e=this.author.username||"";return t=t?t+" - ":"",e=e?e+" - ":"",{titleTemplate:null,title:""+t+e+"掘金小册"}},methods:c()({},Object(d.mapActions)({toogle_suspension:l.CHANGE_SUSPENSION_PANEL}),{buyBook:function(){var t=this.$getBean("eventBus");t.emit(t.eventType.BOOK_PAYMENT,this.bookInfo)},initImageViewer:function(){this.$refs.imageViewer.attachContainer(this.$refs.bookBody)},getXiaoce:function(){this.getXiaoceById()},getXiaoceById:function(){var t=this;return this.$getBean("xiaoceBusiness").getXiaoceById(this.bookId).then(function(e){t.bookInfo=e,t.getListSection()})},getListSection:function(){var t=this;this.$getBean("xiaoceBusiness").getListSection(this.bookId).then(function(e){t.sectionList=e.map(function(t){return a()(t,{read:!1})}),t.sectionId?t.getSection():t.redirectSection()})},getSection:function(){var t=this,e=this.sectionId;this.setSectionListIsRead(e),this.$getBean("xiaoceBusiness").getXiaoceSection(e).then(function(e){if(!e.id)return s.a.reject(new Error);var i=t.$getBean("articleBusiness");t.sectionInfo=a()({},e,{html:i.processArticleHtml(e.html,{lazyload:!0})}),t.$nextTick(function(){t.initImageViewer(),t.initLazyload()})}).catch(function(e){t.sectionInfo=null})},initLazyload:function(){var t=this;setTimeout(function(){var e=t.$refs.bookBody.querySelectorAll("img.lazyload");t.lazyload=new f.a(e,{threshold:200,debounce:!0,eagerShowing:!0,infoGetter:function(t){var e=t.getAttribute("data-src");if(e)return{url:e,width:t.getAttribute("data-width"),height:t.getAttribute("data-height")}}})})},setFreeSection:function(t,e){var i=this;this.$getBean("xiaoceBusiness").setFreeSection(t,e).then(function(t){i.getListSection()}).catch(function(t){i.$alert(t)})},redirectSection:function(){var t=this.filterList&&this.filterList[0];t?(this.setSectionListIsRead(t),this.$router.replace({params:{id:this.bookId,sectionId:t}})):this.$router.push({name:"bookInfo",params:{id:this.bookId}})},loopComponent:function(){var t=this.view;this.view="prev"===t?"next":"prev"},prevPage:function(t){(t=t||this.filterList[this.curFreeDirectoryIndex-1])&&(this.setSectionListIsRead(t),this.sectionInfo={},this.direction="prev",this.$router.push({params:{sectionId:t}}))},nextPage:function(t){(t=t||this.filterList[this.curFreeDirectoryIndex+1])&&(this.setSectionListIsRead(t),this.direction="next",this.sectionInfo={},this.$router.push({params:{sectionId:t}}))},setSectionIsRead:function(t,e){var i=a()(this.sectionList[t],{read:e});this.$set(this.sectionList,t,i)},setSectionListIsRead:function(t,e){var i=this,n=this.sectionIdList.indexOf(t);e=!!e,n>-1&&this.sectionIdList.forEach(function(t,e){e<n?i.setSectionIsRead(e,!0):i.setSectionIsRead(e,!1)})},linkSection:function(t){var e=this.sectionIdList.indexOf(t);this.curDirectoryIndex>e?(this.direction="prev",this.prevPage(t)):(this.direction="next",this.nextPage(t)),this.unfoldM=!1},toggleSummary:function(){var t=this.unfoldM,e=this.foldPc;this.unfoldM=!t,this.foldPc=!e},toggleQrPopup:function(t){var e=this.qrHide;this.qrHide=!e},hideQrPopup:function(){var t=this;this.qrHide=!0,window.localStorage.setItem("bookQrHideSection",!0);var e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.ROOT_CONTAINER_CLICK,function(){t.qrHide=!0})},initQrHide:function(){var t=window.localStorage.getItem("bookQrHideSection");this.qrHide=t},initScroll:function(){var t=this;this.removeScrollDirectionChangeEventListener=Object(u.i)(window,function(e,i){var n="up"===e,s=i<=50;t.needHide=s&&!n,t.isHeaderVisible=s||n},50),this.removeScrollEventListener=Object(u.g)(window,function(){window.pageYOffset<=50&&!t.isHeaderVisible?t.isHeaderVisible=!0:t.needHide&&(t.needHide=!1,t.isHeaderVisible=!1)},50)},initPlayDirection:function(){var t=this;this.removeDirectionListener=Object(u.e)(document,"keyup",function(e){37===e.keyCode?t.prevPage():39===e.keyCode&&t.nextPage()})},fetch:function(){this.getXiaoce()},reset:function(){this.toogle_suspension(!0)}}),mounted:function(){this.initQrHide(),this.initScroll(),this.toogle_suspension(!1),this.fetch(),this.initPlayDirection()},beforeDestroy:function(){this.reset(),this.removeDirectionListener(),this.removeScrollEventListener(),this.removeScrollDirectionChangeEventListener()}}},1574:function(t,e,i){function n(t){i(1575)}var s=i(8)(i(1576),i(1577),n,"data-v-600d9c48",null);t.exports=s.exports},1575:function(t,e){},1576:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["curIndex","list"]}},1577:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"book-progress"},[i("ul",t._l(t.list,function(e,n){return i("li",{class:{active:n<=t.curIndex}})}))])},staticRenderFns:[]}},1578:function(t,e,i){function n(t){i(1579)}var s=i(8)(i(1580),i(1581),n,"data-v-76ca1e36",null);t.exports=s.exports},1579:function(t,e){},1580:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["free","curIndex","list"],data:function(){return{}},computed:{notLastPage:function(){return this.curIndex<this.list.length-1},notFirstPage:function(){return this.curIndex>0},bookId:function(){return this.$route.params.id}},methods:{buyBook:function(){this.$emit("buy")},prevPage:function(){this.$emit("prev")},nextPage:function(){this.$emit("next")}},mounted:function(){}}},1581:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.list.length>0?n("div",{staticClass:"book-handle"},[t.notFirstPage?n("div",{staticClass:"step-btn step-btn--prev",on:{click:t.prevPage}},[n("img",{attrs:{src:i(1582)}})]):t._e(),t.notLastPage?n("div",{staticClass:"step-btn step-btn--next",on:{click:t.nextPage}},[n("img",{attrs:{src:i(1583)}})]):t._e(),!t.notLastPage&&t.free?n("router-link",{staticClass:"step-btn step-btn--finished",attrs:{to:t.$booksIndex()}},[n("img",{attrs:{src:i(1584)}})]):t._e(),t.notLastPage||t.free?t._e():n("div",{staticClass:"step-btn step-btn--buy",on:{click:t.buyBook}},[t._v("购买")])],1):t._e()},staticRenderFns:[]}},1582:function(t,e){t.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgc3Ryb2tlPSIjRkZGIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0xOSAyM2wtNy02LjUgNy02LjUiLz4KPC9zdmc+Cg=="},1583:function(t,e){t.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgc3Ryb2tlPSIjRkZGIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0xMyAyMmw3LTYuNUwxMyA5Ii8+Cjwvc3ZnPgo="},1584:function(t,e){t.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgc3Ryb2tlPSIjMDA2Q0ZGIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik03IDE1LjVsNiA3TDI2LjUgMTAiLz4KPC9zdmc+Cg=="},1585:function(t,e,i){function n(t){i(1586),i(1587)}var s=i(8)(i(1588),i(1593),n,"data-v-8a5cc2ba",null);t.exports=s.exports},1586:function(t,e){},1587:function(t,e){},1588:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1589),s=i.n(n);e.default={components:{SectionHandle:s.a},props:["curIndex","free","admin","info","list"],data:function(){return{defaultText:"小册章节标题"}},computed:{tryRead:function(){var t=this.info,e=t.price,i=t.isBuy;return!(0===e)&&this.admin||!i},bookId:function(){return this.$route.params.id}},methods:{setFreeSection:function(t,e){this.$emit("setFreeSection",t,e)},routeSectionId:function(t){var e=(t.isFree,t.sectionId);t.isFinished;e!==this.$route.params.sectionId&&this.$emit("linkSection",e)}},mounted:function(){}}},1589:function(t,e,i){function n(t){i(1590)}var s=i(8)(i(1591),i(1592),n,"data-v-09cfbe39",null);t.exports=s.exports},1590:function(t,e){},1591:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(25),s=i.n(n);e.default={props:["info","item"],data:function(){return{actionItem:{more:{active:!1}}}},computed:{bookId:function(){return this.$route.params.id}},methods:{toggleActivateActionItem:function(t){var e=this;s()(this.actionItem).forEach(function(i){e.actionItem[i].active=t===i&&!e.actionItem[i].active})},routeEdit:function(t){var e="/editor/book/"+this.bookId+"/section/"+t;window.open(e,"_blank")},setFreeSection:function(t,e){this.$emit("setFreeSection",t,e)}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.ROOT_CONTAINER_CLICK,function(){s()(t.actionItem).forEach(function(e){t.actionItem[e].active=!1})})}}},1592:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.info.isEditor?i("div",{staticClass:"more",class:{open:t.actionItem.more.active},on:{mouseleave:function(e){t.actionItem.more.active=!1},click:function(e){e.stopPropagation(),e.preventDefault(),t.toggleActivateActionItem("more")}}},[i("div",{staticClass:"more-menu"},[t.item.isFree?t._e():i("div",{on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.setFreeSection(t.item.sectionId,!0)}}},[t._v("设置为试读")]),t.item.isFree?i("div",{on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.setFreeSection(t.item.sectionId,!1)}}},[t._v("取消试读")]):t._e(),i("div",{on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.routeEdit(t.item.sectionId)}}},[t._v("编辑")])])]):t._e()},staticRenderFns:[]}},1593:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"section-menu"},t._l(t.list,function(e,n){return i("a",{key:n,staticClass:"section",class:{"route-active":n===t.curIndex,"section-link":t.free||e.isFree,read:e.read},on:{click:function(i){t.routeSectionId(e)}}},[i("div",{staticClass:"step"},[i("div",{staticClass:"step-btn"},[t._v(t._s(n+1))])]),i("div",{staticClass:"center"},[i("div",{staticClass:"title"},[t._v(t._s(e.title||t.defaultText))]),e.isFree&&t.tryRead?i("div",{staticClass:"sub-line"},[i("div",{staticClass:"to-read"},[t._v("试读")])]):t._e(),t.info.isFinished||e.isFinished?t._e():i("div",{staticClass:"sub-line"},[i("div",{staticClass:"writing"},[t._v("写作中...")])])]),i("section-handle",{attrs:{info:t.info,item:e},on:{setFreeSection:t.setFreeSection}})],1)}))},staticRenderFns:[]}},1594:function(t,e,i){function n(t){i(1595)}var s=i(8)(i(1596),i(1597),n,"data-v-11fc2358",null);t.exports=s.exports},1595:function(t,e){},1596:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(94),s=i.n(n),o=i(225),a=i(58),r=i(10),c=i(222),u=i.n(c);e.default={components:{Avatar:u.a},data:function(){return{bdPageUrlForNav:o.e,isShowUserDropdownList:!1}},computed:s()({},Object(a.mapGetters)({user:r.USER,hasWallet:r.HAS_WALLET})),methods:{hideActionList:function(){this.isShowUserDropdownList=!1},onUserActionClick:function(){this.isShowUserDropdownList=!this.isShowUserDropdownList},openEditorPage:function(){var t=this.$getBean("editorBusiness");window.location.href=t.getPostEditUrl()},openXiaoceEditorPage:function(){var t=this.$getBean("editorBusiness");window.location.href=t.getXiaoceEditUrl()},openDraftIndexPage:function(){var t=this.$getBean("editorBusiness");window.location.href=t.getDraftIndexUrl()},login:function(){this.$requestLogin()},register:function(){this.$requestRegister()},logout:function(){window.confirm("确定登出吗？每一片贫瘠的土地都需要坚定的挖掘者！")&&this.$requestLogout()}},mounted:function(){var t=this,e=this.$getBean("eventBus");e.onVmLife(this,e.eventType.ROOT_CONTAINER_CLICK,function(){t.hideActionList()})}}},1597:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"user-auth"},[t.user?i("div",{staticClass:"nav-item menu",on:{click:function(e){e.stopPropagation(),t.onUserActionClick(e)}}},[i("avatar",{staticClass:"avatar",attrs:{user:t.user,decorative:!0}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowUserDropdownList,expression:"isShowUserDropdownList"}],staticClass:"nav-menu user-dropdown-list"},[i("ul",{staticClass:"nav-menu-item-group"},[i("li",{staticClass:"nav-menu-item",on:{click:t.openEditorPage}},[t._m(0)]),t.user.isXiaoceAuthor?i("li",{staticClass:"nav-menu-item",on:{click:t.openXiaoceEditorPage}},[t._m(1)]):t._e(),i("li",{staticClass:"nav-menu-item",on:{click:t.openDraftIndexPage}},[t._m(2)])]),i("ul",{staticClass:"nav-menu-item-group"},[i("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:t.$userRoute(t.user)}},[i("a",[i("i",{staticClass:"fengwei fw-person"}),i("span",[t._v("我的主页")])])]),i("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:t.$userRoute(t.user,"likes")}},[i("a",[i("i",{staticClass:"fengwei fw-like"}),i("span",[t._v("我喜欢的")])])]),t.user.isXiaoceAuthor?i("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:t.$userRoute(t.user,"books",{type:"bought"})}},[i("a",[i("i",{staticClass:"fengwei fw-xiaoce"}),i("span",[t._v("我的小册")])])]):t._e(),i("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:t.$userRoute(t.user,"collections")}},[i("a",[i("i",{staticClass:"fengwei fw-collection"}),i("span",[t._v("我的收藏集")])])]),i("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:t.$userRoute(t.user,"books",{type:"bought"})}},[i("a",[i("i",{staticClass:"fengwei fw-bought"}),i("span",[t._v("已购")])])]),t.hasWallet?i("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:"/user/wallet"}},[i("a",[i("i",{staticClass:"fengwei fw-wallet"}),i("span",[t._v("我的钱包")])])]):t._e(),i("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:"/subscribe"}},[i("a",[i("i",{staticClass:"fengwei fw-tag"}),i("span",[t._v("标签管理")])])])],1),i("ul",{staticClass:"nav-menu-item-group"},[t.user?i("router-link",{staticClass:"nav-menu-item",attrs:{tag:"li",to:"/user/settings"}},[i("a",[i("i",{staticClass:"fengwei fw-setting"}),i("span",[t._v("设置")])])]):t._e(),i("li",{staticClass:"nav-menu-item more"},[t._m(3),i("div",{staticClass:"nav-menu more-dropdown-list"},[i("ul",{staticClass:"nav-menu-item-group"},[i("li",{staticClass:"nav-menu-item"},[i("a",{directives:[{name:"link",rawName:"v-link.blank",value:"/app",expression:"'/app'",modifiers:{blank:!0}}]},[t._v("下载应用")])]),i("li",{staticClass:"nav-menu-item"},[i("a",{directives:[{name:"link",rawName:"v-link.blank",value:"/about",expression:"'/about'",modifiers:{blank:!0}}]},[t._v("关于")])]),i("li",{staticClass:"nav-menu-item"},[i("a",{directives:[{name:"link",rawName:"v-link.blank",value:"https://xitu.io/jobs",expression:"'https://xitu.io/jobs'",modifiers:{blank:!0}}]},[t._v("加入我们")])]),i("li",{staticClass:"nav-menu-item"},[i("a",{directives:[{name:"link",rawName:"v-link.external.blank",value:"https://github.com/xitu/gold-miner",expression:"'https://github.com/xitu/gold-miner'",modifiers:{external:!0,blank:!0}}]},[t._v("翻译计划")])]),i("li",{staticClass:"nav-menu-item"},[i("a",{directives:[{name:"link",rawName:"v-link.blank",value:t.bdPageUrlForNav,expression:"bdPageUrlForNav",modifiers:{blank:!0}}]},[t._v("合作伙伴")])])])])])],1),t.user?i("ul",{staticClass:"nav-menu-item-group"},[i("li",{staticClass:"nav-menu-item",on:{click:t.logout}},[t._m(4)])]):t._e()])],1):t._e(),t.user?t._e():i("div",{staticClass:"nav-item auth"},[i("span",{staticClass:"login",on:{click:t.login}},[t._v("登录")]),i("span",{staticClass:"register",on:{click:t.register}},[t._v("注册")])])])},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a",[i("i",{staticClass:"fengwei fw-write"}),i("span",[t._v("写文章")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a",[i("i",{staticClass:"fengwei fw-xiaocepost"}),i("span",[t._v("写小册")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a",[i("i",{staticClass:"fengwei fw-draft"}),i("span",[t._v("草稿")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a",[i("i",{staticClass:"fengwei fw-info"}),i("span",[t._v("关于")]),i("i",{staticClass:"ion-chevron-right more-icon"})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a",[i("i",{staticClass:"fengwei fw-logout"}),i("span",[t._v("登出")])])}]}},1598:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.bookInfo?n("div",{staticClass:"book-read-view"},[n("section",{staticClass:"book-section",class:{"fold-pc":t.foldPc}},[n("div",{staticClass:"book-summary",class:{"unfold-mobile":t.unfoldM}},[n("div",{staticClass:"book-summary-masker",on:{click:t.toggleSummary}}),n("div",{staticClass:"book-summary-inner"},[n("div",{staticClass:"book-summary__header"},[n("app-link",{staticClass:"logo",attrs:{to:t.$booksIndex()}},[n("img",{attrs:{src:i(1599)}})]),n("div",{staticClass:"label"},[t._v("小册")]),1==t.bookInfo.isPublish?n("div",{staticClass:"audit"},[t._v("审核中")]):t._e()],1),t.free?t._e():n("div",{staticClass:"section-buy",on:{click:t.buyBook}},[t._v("立即购买")]),n("book-directory",{staticClass:"book-directory",class:{bought:!t.canPayment},attrs:{free:t.free,admin:t.isAdmin,info:t.bookInfo,list:t.sectionList,"cur-index":t.curDirectoryIndex},on:{setFreeSection:t.setFreeSection,linkSection:t.linkSection}}),n("div",{staticClass:"book-summary__footer",on:{click:function(t){t.stopPropagation()}}},[n("div",{staticClass:"qr-icon",on:{click:function(e){e.stopPropagation(),t.toggleQrPopup(e)}}},[n("img",{attrs:{src:i(1600)}})]),n("div",{staticClass:"qr-tips",class:{show:!t.qrHide}},[n("span",{staticClass:"ion-close",on:{click:t.hideQrPopup}}),t._m(0),t._m(1)])])],1)]),n("div",{staticClass:"book-content"},[n("div",{staticClass:"book-content-inner"},[n("div",{staticClass:"book-content__header",class:{visible:t.isHeaderVisible}},[n("div",{staticClass:"switch",on:{click:t.toggleSummary}},[n("img",{attrs:{src:i(1601)}})]),n("div",{staticClass:"menu",on:{click:t.toggleSummary}},[n("img",{attrs:{src:i(1602)}})]),n("div",{staticClass:"title"},[n("app-link",{attrs:{to:t.$bookInfo(t.bookId)}},[t._v(t._s(t.bookInfo.title))])],1),n("user-auth",{staticClass:"user-auth"}),t.foldPc?n("book-progress",{staticClass:"book-progress",attrs:{"cur-index":t.curDirectoryIndex,list:t.sectionIdList}}):t._e()],1),n("div",{ref:"bookBody",staticClass:"book-body",class:t.directionClass},[n("transition",{attrs:{name:"fade"}},[n("section-"+t.view,{tag:"component",staticClass:"book-section-content",attrs:{free:t.free,user:t.user,"book-info":t.bookInfo,"section-info":t.sectionInfo},on:{buy:t.buyBook}})],1)],1),n("book-direction",{directives:[{name:"show",rawName:"v-show",value:t.sectionInfo&&t.curFreeDirectoryIndex>-1,expression:"sectionInfo && curFreeDirectoryIndex > -1"}],staticClass:"book-direction",attrs:{free:t.free,"cur-index":t.curFreeDirectoryIndex,list:t.filterList},on:{buy:t.buyBook,prev:t.prevPage,next:t.nextPage}}),!t.free&&t.sectionInfo?n("div",{staticClass:"bottom-mobile-buy",on:{click:t.buyBook}},[t._v("购买 ￥"+t._s(t.bookInfo.price))]):t._e()],1)])]),n("wechat-quick-login"),n("book-payment-popup"),n("image-viewer",{ref:"imageViewer",attrs:{"background-color":"rgba(0,0,0,.65)"}})],1):t._e()},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"title"},[i("span",[t._v("关注公众号")]),i("span",[t._v("领取优惠码")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"qr-img"},[n("img",{attrs:{src:i(1603)}})])}]}},1599:function(t,e,i){t.exports=i.p+"static/img/logo.a7995ad.svg"},1600:function(t,e){t.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIj4KICAgIDxwYXRoIGZpbGw9IiNCQUJBQkEiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTExIDBoOXY5aC05VjB6TTAgMGg5djlIMFYwem0wIDExaDl2OUgwdi05em0xNC01aDNWM2gtM3Yzek0zIDZoM1YzSDN2M3ptMCAxMXYtM2gzdjNIM3ptOC02aDN2M2gtM3YtM3ptMyAzaDN2M2gtM3YtM3ptMy0zaDN2M2gtM3YtM3ptLTYgNmgzdjNoLTN2LTN6bTYgMGgzdjNoLTN2LTN6Ii8+Cjwvc3ZnPgo="},1601:function(t,e){t.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQwcHgiIGhlaWdodD0iNDBweCIgdmlld0JveD0iMCAwIDQwIDQwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbG5zOnNrZXRjaD0iaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoL25zIj4KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggMy4zLjMgKDEyMDgxKSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5qdWVqaW5fbG9nbyBjb3B5PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+PC9kZWZzPgogICAgPGcgaWQ9IlBhZ2UtMSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgc2tldGNoOnR5cGU9Ik1TUGFnZSI+CiAgICAgICAgPGcgaWQ9Imp1ZWppbl9sb2dvLWNvcHkiIHNrZXRjaDp0eXBlPSJNU0FydGJvYXJkR3JvdXAiIGZpbGw9IiMwMDdGRkYiPgogICAgICAgICAgICA8cGF0aCBkPSJNMjMuMjgxOTk4NCw3LjcwMzA1NDUgTDE5Ljg1Mzg3MTQsNSBMMTYuMjcyMTkxOCw3LjgyNDE3NTcgTDE2LjA4NjUzODgsNy45NzM3NTcwNyBMMTkuODUzODcxNCwxMC45Nzc2MjkgTDIzLjYzMjc4NjYsNy45NzM3NTcwNyBMMjMuMjgxOTk4NCw3LjcwMzA1NDUgWiBNMzYuMjcyNzQzMywxOC4xODU2NjQgTDE5Ljg0Mzk0MzQsMzEuMTQwMDA2NCBMMy40MjUwNzE0MywxOC4xOTM2MDY0IEwxLDIwLjE0MTQ3MzUgTDE5Ljg0Mzk0MzQsMzUgTDM4LjY5ODE0NTcsMjAuMTMzNTMxMiBMMzYuMjcyNzQzMywxOC4xODU2NjQgWiBNMTkuODQzOTQzNCwxOS4yMzY3MDQ4IEwxMC45MDM4MDksMTIuMTg3NTE3MiBMOC40Nzg0MDY2NywxNC4xMzUzODQ0IEwxOS44NDM5NDM0LDIzLjA5NzAyOTMgTDMxLjIxOTA3NzEsMTQuMTI3NDQyIEwyOC43OTM2NzQ4LDEyLjE3OTU3NDkgTDE5Ljg0Mzk0MzQsMTkuMjM2NzA0OCBaIiBpZD0iRmlsbC0xLUNvcHktMiIgc2tldGNoOnR5cGU9Ik1TU2hhcGVHcm91cCI+PC9wYXRoPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+"},1602:function(t,e){t.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxM3B4IiB2aWV3Qm94PSIwIDAgMTYgMTMiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDQ3LjEgKDQ1NDIyKSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5Hcm91cCA0PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+PC9kZWZzPgogICAgPGcgaWQ9IuWFqOWxjyIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9IjJfZnVsbHNjcmVlbl9jbG9zZS1zaWRlYmFyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTkuMDAwMDAwLCAtMjUuMDAwMDAwKSIgZmlsbD0iIzk3OTc5NyI+CiAgICAgICAgICAgIDxnIGlkPSJHcm91cC00IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxOS4wMDAwMDAsIDI1LjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPHJlY3QgaWQ9IlJlY3RhbmdsZS0zIiB4PSIwIiB5PSI1LjUiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxLjUiPjwvcmVjdD4KICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtMyIgeD0iMCIgeT0iMCIgd2lkdGg9IjE2IiBoZWlnaHQ9IjEuNSI+PC9yZWN0PgogICAgICAgICAgICAgICAgPHJlY3QgaWQ9IlJlY3RhbmdsZS0zLUNvcHkiIHg9IjAiIHk9IjExIiB3aWR0aD0iMTYiIGhlaWdodD0iMS41Ij48L3JlY3Q+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg=="},1603:function(t,e,i){t.exports=i.p+"static/img/wx-qr.13d8b4d.png"},925:function(t,e,i){function n(t){i(1572)}var s=i(8)(i(1573),i(1598),n,"data-v-a39a1c6e",null);t.exports=s.exports},964:function(t,e,i){function n(t){i(967)}var s=i(8)(i(968),i(969),n,"data-v-009ea7bb",null);t.exports=s.exports},965:function(t,e,i){function n(t){i(972)}var s=i(8)(i(973),i(976),n,"data-v-311d2efa",null);t.exports=s.exports},966:function(t,e,i){"use strict";function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000000",i=new o.a({content:t,color:e,padding:0,width:410,height:410,background:"#ffffff",ecl:"L"}).svg();return"data:image/svg+xml;utf8,"+encodeURIComponent(i)}e.a=n;var s=i(224),o=i.n(s)},967:function(t,e){},968:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(95),s=i(157),o=i(39),a=i.n(o);e.default={components:{Lazy:a.a},props:["url","default","quality","width","height","shrink","format","size","alt","blank"],computed:{defaultThumbUrl:function(){return this.default||n.e},thumbUrl:function(){var t=this.url||(this.blank?"":this.defaultThumbUrl);return this.shrink?Object(s.b)(t,this.width,this.height,{format:this.format,quality:this.quality}):Object(s.a)(t,this.width,this.height,{format:this.format,quality:this.quality})},thumbStyle:function(){return{backgroundSize:this.size||"cover"}}}}},969:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("lazy",{staticClass:"thumb",style:t.thumbStyle,attrs:{div:!0,url:t.thumbUrl}})},staticRenderFns:[]}},970:function(t,e,i){function n(t){i(974)}var s=i(8)(null,i(975),n,"data-v-494d384d",null);t.exports=s.exports},971:function(t,e,i){"use strict";function n(t,e){var i=isNaN(e)?1:e/10,n=s(t,i);return 0===n?0:n.toFixed(2)}function s(t,e){var i=0,n=t.toString(),s=e.toString();try{i+=n.split(".")[1].length}catch(t){}try{i+=s.split(".")[1].length}catch(t){}n=Number(n.replace(".","")),s=Number(s.replace(".",""));var o=n*s/Math.pow(10,i),a=e>0?.01:0;return Math.max(a,o)}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{free:0,charge:10},e=t.free,i=t.charge,n=e>0,s=i<10;return n?0:s?i:10}function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[t.timeLimitDiscount,t.timeLimitDiscountFirstDay].some(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.startUTC,i=void 0===e?null:e,n=t.endUTC,s=void 0===n?null:n,o=(t.discountCount,+new Date),a=+new Date(i),r=+new Date(s);return o>a&&o<r})}function r(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,i=[{title:"早鸟价",type:"timeLimitDiscountFirstDay"},{title:"限时优惠价",type:"timeLimitDiscount"}],n=t.timeLimitDiscount,s=void 0===n?{}:n,o=t.timeLimitDiscountFirstDay,a=void 0===o?{}:o,r=[a,s].map(function(t,n){var s=t.startUTC,o=void 0===s?null:s,a=t.endUTC,r=void 0===a?null:a,c=t.discountCount,l=void 0===c?10:c,d=+new Date(o),m=+new Date(r),f=l;return u()({id:e},i[n],{startTime:d,endTime:m,sale:f})}),c={},l=0;l<2;l++){var d=+new Date,m=r[l],f=m.startTime,h=void 0===f?null:f,p=m.endTime,v=void 0===p?null:p,g=m.sale,y=void 0===g?10:g,b=y>=0&&y<10,C=d>h&&d<v;if(b&&C){c=r[l];break}}return c}e.a=n,e.b=o,e.d=a,e.c=r;var c=i(3),u=i.n(c)},972:function(t,e){},973:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(223),o=i(222),a=i.n(o),r=i(970),c=i.n(r);e.default={components:{Avatar:a.a,Triangle:c.a},props:["userId"],data:function(){return{user:null,followLock:Object(s.a)(),visible:!1,top:0,left:0,isTop:!1}},computed:{popoverStyle:function(){return{top:this.top+"px",left:this.left+"px"}},position:function(){return this.user&&(this.$userPosition(this.user)||this.user.self_description||"暂无简介")},self:function(){return this.user&&this.user.self},followed:function(){return this.user&&this.user.followed}},methods:{fetch:function(){var t=this;return this.$getBean("userBusiness").getUserById(this.userId).then(function(e){t.user=e})},toggleFollow:function(){var t=this;this.followLock.do(function(){return t.$ensureAuthorized().then(function(){return t.$store.dispatch(n.TOGGLE_FOLLOW_USER,t.user).catch(function(e){t.$error(e)})}).catch(function(){})})},showPopover:function(t){var e=this;clearTimeout(this.hideToken),this.showToken=setTimeout(function(){e.fetch().then(function(){e.showToken&&(e.visible=!0,e.$nextTick(function(){var i=t.target.getBoundingClientRect(),n=t.target.offsetWidth||33,s=t.target.offsetHeight||33,o=e.$refs.popover,a=o.offsetWidth,r=o.offsetHeight,c=i.left-a/2+n/2,u=i.top-r-12;e.isTop=!1,u<60&&(e.isTop=!0,u=i.top+s+8),c=Math.max(0,c),e.left=c,e.top=u}))})},300)},hidePopover:function(){var t=this;clearTimeout(this.showToken),this.showToken=null,this.hideToken=setTimeout(function(){t.popoverTimeout=null,t.visible=!1},300)}}}},974:function(t,e){},975:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",{staticClass:"container"},[i("em",{staticClass:"triangle"})])}]}},976:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"user-popover-box",attrs:{"st:block":"userPopover","st:state":t.userId},on:{mouseenter:function(e){t.showPopover(e)},mouseleave:t.hidePopover}},[t.visible?i("div",{ref:"popover",staticClass:"user-popover",style:t.popoverStyle},[i("div",{staticClass:"info-row"},[i("app-link",{attrs:{to:t.$userRoute(t.user),blank:!0}},[i("avatar",{staticClass:"avatar",attrs:{user:t.user,decorative:!0}})],1),i("div",{staticClass:"user-info"},[i("app-link",{staticClass:"username",attrs:{to:t.$userRoute(t.user),blank:!0}},[t._v(t._s(t.user.username))]),i("div",{staticClass:"position"},[t._v(t._s(t.position))])],1)],1),i("div",{staticClass:"meta-row"},[i("ul",{staticClass:"meta-list"},[i("li",{staticClass:"item"},[i("div",{staticClass:"count"},[t._v(t._s(t.user.followeesCount||0))]),i("div",{staticClass:"title"},[t._v("关注")])]),i("li",{staticClass:"item"},[i("div",{staticClass:"count"},[t._v(t._s(t.user.followerCount||0))]),i("div",{staticClass:"title"},[t._v("关注者")])])]),t.self?t._e():i("button",{staticClass:"follow-btn",class:{followed:t.followed},attrs:{"st:name":"followBtn"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.toggleFollow(e)}}},[t._v(t._s(t.followed?"已关注":"关注"))])]),i("triangle",{staticClass:"triangle-bottom",class:{isTop:t.isTop}})],1):t._e(),t._t("default")],2)},staticRenderFns:[]}},985:function(t,e,i){var n,s,o;/*!
	Autosize 3.0.20
	license: MIT
	http://www.jacklmoore.com/autosize
*/
!function(i,a){s=[e,t],n=a,void 0!==(o="function"==typeof n?n.apply(e,s):n)&&(t.exports=o)}(0,function(t,e){"use strict";function i(t){function e(e){var i=t.style.width;t.style.width="0px",t.offsetWidth,t.style.width=i,t.style.overflowY=e}function i(t){for(var e=[];t&&t.parentNode&&t.parentNode instanceof Element;)t.parentNode.scrollTop&&e.push({node:t.parentNode,scrollTop:t.parentNode.scrollTop}),t=t.parentNode;return e}function n(){var e=t.style.height,n=i(t),s=document.documentElement&&document.documentElement.scrollTop;t.style.height="auto";var o=t.scrollHeight+r;if(0===t.scrollHeight)return void(t.style.height=e);t.style.height=o+"px",c=t.clientWidth,n.forEach(function(t){t.node.scrollTop=t.scrollTop}),s&&(document.documentElement.scrollTop=s)}function s(){n();var i=Math.round(parseFloat(t.style.height)),s=window.getComputedStyle(t,null),o=Math.round(parseFloat(s.height));if(o!==i?"visible"!==s.overflowY&&(e("visible"),n(),o=Math.round(parseFloat(window.getComputedStyle(t,null).height))):"hidden"!==s.overflowY&&(e("hidden"),n(),o=Math.round(parseFloat(window.getComputedStyle(t,null).height))),u!==o){u=o;var r=a("autosize:resized");try{t.dispatchEvent(r)}catch(t){}}}if(t&&t.nodeName&&"TEXTAREA"===t.nodeName&&!o.has(t)){var r=null,c=t.clientWidth,u=null,l=function(){t.clientWidth!==c&&s()},d=function(e){window.removeEventListener("resize",l,!1),t.removeEventListener("input",s,!1),t.removeEventListener("keyup",s,!1),t.removeEventListener("autosize:destroy",d,!1),t.removeEventListener("autosize:update",s,!1),Object.keys(e).forEach(function(i){t.style[i]=e[i]}),o.delete(t)}.bind(t,{height:t.style.height,resize:t.style.resize,overflowY:t.style.overflowY,overflowX:t.style.overflowX,wordWrap:t.style.wordWrap});t.addEventListener("autosize:destroy",d,!1),"onpropertychange"in t&&"oninput"in t&&t.addEventListener("keyup",s,!1),window.addEventListener("resize",l,!1),t.addEventListener("input",s,!1),t.addEventListener("autosize:update",s,!1),t.style.overflowX="hidden",t.style.wordWrap="break-word",o.set(t,{destroy:d,update:s}),function(){var e=window.getComputedStyle(t,null);"vertical"===e.resize?t.style.resize="none":"both"===e.resize&&(t.style.resize="horizontal"),r="content-box"===e.boxSizing?-(parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)):parseFloat(e.borderTopWidth)+parseFloat(e.borderBottomWidth),isNaN(r)&&(r=0),s()}()}}function n(t){var e=o.get(t);e&&e.destroy()}function s(t){var e=o.get(t);e&&e.update()}var o="function"==typeof Map?new Map:function(){var t=[],e=[];return{has:function(e){return t.indexOf(e)>-1},get:function(i){return e[t.indexOf(i)]},set:function(i,n){-1===t.indexOf(i)&&(t.push(i),e.push(n))},delete:function(i){var n=t.indexOf(i);n>-1&&(t.splice(n,1),e.splice(n,1))}}}(),a=function(t){return new Event(t,{bubbles:!0})};try{new Event("test")}catch(t){a=function(t){var e=document.createEvent("Event");return e.initEvent(t,!0,!1),e}}var r=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?(r=function(t){return t},r.destroy=function(t){return t},r.update=function(t){return t}):(r=function(t,e){return t&&Array.prototype.forEach.call(t.length?t:[t],function(t){return i(t)}),t},r.destroy=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],n),t},r.update=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],s),t}),e.exports=r})},986:function(t,e,i){function n(t){i(1075)}var s=i(8)(i(1076),i(1077),n,"data-v-65d5b7df",null);t.exports=s.exports},987:function(t,e){function i(t){if(navigator.clipboard)return navigator.clipboard.writeText(t);var e=document.createElement("span");e.textContent=t,e.style.whiteSpace="pre";var i=document.createElement("iframe");i.sandbox="allow-same-origin",document.body.appendChild(i);var n=i.contentWindow;n.document.body.appendChild(e);var s=n.getSelection();s||(n=window,s=n.getSelection(),document.body.appendChild(e));var o=n.document.createRange();s.removeAllRanges(),o.selectNode(e),s.addRange(o);var a=!1;try{a=n.document.execCommand("copy")}catch(t){}return s.removeAllRanges(),n.document.body.removeChild(e),document.body.removeChild(i),a?Promise.resolve():Promise.reject()}t.exports=i}});